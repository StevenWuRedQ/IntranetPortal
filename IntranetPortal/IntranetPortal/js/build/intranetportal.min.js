/*! intranetportal 2015-12-24 */
var portalApp=angular.module("PortalApp",["ngSanitize","ngAnimate","dx","ngMask","ui.bootstrap","ui.select","ui.layout"]);angular.module("PortalApp").controller("MainCtrl",["$rootScope","$uibModal","$timeout",function(a,b,c){a.AlertModal=null,a.ConfirmModal=null,a.loadingCover=document.getElementById("LodingCover"),a.panelLoading=!1,a.alert=function(c){a.alertMessage=c?c:"",a.AlertModal=b.open({templateUrl:"AlertModal"})},a.alertOK=function(){a.AlertModal.close()},a.confirm=function(c){return a.confirmMessage=c?c:"",a.ConfirmModal=b.open({templateUrl:"ConfirmModal"}),a.ConfirmModal.result},a.confirmYes=function(){a.ConfirmModal.close(!0)},a.confirmNo=function(){a.ConfirmModal.close(!1)},a.showLoading=function(b){$(a.loadingCover).show()},a.hideLoading=function(b){$(a.loadingCover).hide()},a.toggleLoading=function(){a.panelLoading=!$scope.panelLoading},a.startLoading=function(){a.panelLoading=!0},a.stopLoading=function(){c(function(){a.panelLoading=!1})}}]),angular.module("PortalApp").service("ptCom",["$http","$rootScope",function(a,b){var c=this;this.DocGenerator=function(b,c,d){a.post("/Services/Documents.svc/DocGenrate",{tplName:b,data:JSON.stringify(c)}).success(function(a){d(a)}).error(function(a,b){alert("Fail to save data. status: "+b+" Error : "+JSON.stringify(a))})},this.arrayAdd=function(a,b){a&&(b=b?b:{},a.push(b))},this.arrayRemove=function(a,b,d,e){a&&b<a.length&&(d?c.confirm("Delete This?","").then(function(c){if(c){var d=a.splice(b,1)[0];e&&e(d)}}):a.splice(b,1))},this.formatAddr=function(a,b,c,d,e,f){var g="";return a&&(g+=a+" "),b&&(g+=b+", "),c&&(g+="Apt "+c+", "),d&&(g+=d+", "),e&&(g+=e+", "),f&&(g+=f),g},this.capitalizeFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},this.formatName=function(a,b,d){var e="";return a&&(e+=c.capitalizeFirstLetter(a)+" "),b&&(e+=c.capitalizeFirstLetter(b)+" "),d&&(e+=c.capitalizeFirstLetter(d)),e},this.ensureArray=function(a,b){a.$eval(b)||a.$eval(b+"=[]")},this.ensurePush=function(a,b,d){c.ensureArray(a,b),d=d?d:{};var e=a.$eval(b);e.push(d)},this.nullToUndefined=function(a){for(var b in a)a.hasOwnProperty(b)&&(null===a[b]?a[b]=void 0:"object"==typeof a[b]&&c.nullToUndefined(a[b]))},this.printDiv=function(a){var b=document.getElementById(a),c=window.open("","_blank","width=300,height=300");c.document.open(),c.document.write('<html><head><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900" /><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css" /><link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" /><link rel="stylesheet" href="/Content/bootstrap-datepicker3.css" /><link rel="stylesheet" href="http://cdn3.devexpress.com/jslib/15.1.6/css/dx.common.css" /><link rel="stylesheet" href="http://cdn3.devexpress.com/jslib/15.1.6/css/dx.light.css" /><link rel="stylesheet" href="/css/stevencss.css"type="text/css" /></head><body onload="window.print()">'+b.innerHTML+"</html>"),c.document.close()},this.postRequest=function(a,b){$.post(a,b,function(a){$("body").append("<iframe src='"+a.url+"' style='display: none;' ></iframe>")})},this.alert=function(a){b.alert(a)},this.confirm=function(a){return b.confirm(a)},this.addOverlay=function(){b.addOverlay()},this.stopLoading=function(){b.stopLoading()},this.startLoading=function(){b.startLoading()},this.removeOverlay=function(){b.removeOverlay()},this.next=function(a,b,c){return a.indexOf(b,c)},this.previous=function(a,b,c){for(var d=-1,e=0;c>e;e++)a[e]===b&&(d=e);return d},this.saveBlob=function(a,b){var c=document.createElement("a");c.style="display: none";var d=window.URL.createObjectURL(a);c.href=d,c.download=b,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(d),document.body.removeChild(c)},this.toUTCLocaleDateString=function(a){var b=new Date(a);return b.getUTCMonth()+1+"/"+b.getUTCDate()+"/"+b.getUTCFullYear()}}]).service("ptFileService",function(){this.isIE=function(a){return a.indexOf(":\\")>-1},this.getFileName=function(a){var b;return a?this.isIE(a)?(b=a.split("\\"),this.cleanName(b[b.length-1])):(b=a.split("/"),this.cleanName(b[b.length-1])):""},this.getFileExt=function(a){if(a&&a.indexOf(".")>-1){var b=a.split(".");return b[b.length-1].toLowerCase()}return""},this.getFileFolder=function(a){if(a){var b=a.split("/"),c=b[b.length-2],d=["Construction","Title"];return d.indexOf(c)<0?c:""}return""},this.resetFileElement=function(a){a.val(""),a.wrap("<form>").parent("form").trigger("reset"),a.unwrap(),a.prop("files")[0]=null,a.replaceWith(a.clone())},this.cleanName=function(a){return a.replace(/[^a-z0-9_\-\.()]/gi,"_")},this.getThumb=function(a){return"/downloadfile.aspx?thumb="+a},this.trunc=function(a,b){return _.trunc(a,b)},this.isPicture=function(a){var b=this.getFileExt(a),c=["jpg","jpeg","gif","bmp","png"];return c.indexOf(b)>-1},this.uploadFile=function(a,b,c,d,e,f){switch(e){case"construction":this.uploadConstructionFile(a,b,c,d,f);break;case"title":this.uploadTitleFile(a,b,c,d,f);break;default:this.uploadConstructionFile(a,b,c,d,f)}},this.uploadTitleFile=function(a,b,c,d,e){var f=c?c:"";d=d?d:"",a&&b?(b=b.trim(),$.ajax({url:"/api/Title/UploadFiles?bble="+b+"&fileName="+f+"&folder="+d,type:"POST",data:a,cache:!1,processData:!1,contentType:!1,success:function(a){e(null,a,c)},error:function(){e("Upload fails!",null,c)}})):e("Upload infomation missing!")},this.uploadConstructionFile=function(a,b,c,d,e){var f=c?c:"",g=d?d:"";a&&b?(b=b.trim(),$.ajax({url:"/api/ConstructionCases/UploadFiles?bble="+b+"&fileName="+f+"&folder="+g,type:"POST",data:a,cache:!1,processData:!1,contentType:!1,success:function(a){e(null,a,c)},error:function(){e("Upload fails!",null,c)}})):e("Upload infomation missing!")},this.makePreviewUrl=function(a){var b=this.getFileExt(a);switch(b){case"pdf":return"/pdfViewer/web/viewer.html?file="+encodeURIComponent("/downloadfile.aspx?pdfUrl=")+encodeURIComponent(a);case"xls":case"xlsx":case"doc":case"docx":return"/downloadfile.aspx?fileUrl="+encodeURIComponent(a)+"&edit=true";case"jpg":case"jpeg":case"bmp":case"gif":case"png":return"/downloadfile.aspx?fileUrl="+encodeURIComponent(a);default:return"/downloadfile.aspx?fileUrl="+encodeURIComponent(a)}},this.onFilePreview=function(a){var b=this.getFileExt(a);switch(b){case"pdf":window.open("/pdfViewer/web/viewer.html?file="+encodeURIComponent("/downloadfile.aspx?pdfUrl=")+encodeURIComponent(a));break;case"xls":case"xlsx":case"doc":case"docx":window.open("/downloadfile.aspx?fileUrl="+encodeURIComponent(a)+"&edit=true");break;case"jpg":case"jpeg":case"bmp":case"gif":case"png":$.fancybox.open("/downloadfile.aspx?fileUrl="+encodeURIComponent(a));break;case"txt":$.fancybox.open([{type:"ajax",href:"/downloadfile.aspx?fileUrl="+encodeURIComponent(a)}]);break;default:window.open("/downloadfile.aspx?fileUrl="+encodeURIComponent(a))}}}).service("ptConstructionService",["$http",function(a){this.getConstructionCases=function(b,c){var d="/api/ConstructionCases/"+b;a.get(d).success(function(a){c&&c(a)}).error(function(a){console.log("Get Construction Data fails.")})},this.saveConstructionCases=function(b,c,d){if(b&&c){b=b.trim();var e="/api/ConstructionCases/"+b;a.put(e,c).success(function(a){d&&d(a)}).error(function(){alert("Save CSCase fails.")})}},this.getDOBViolations=function(b,c){if(b){var d="/api/ConstructionCases/GetDOBViolations?bble="+b;a.get(d).success(function(a){c&&c(null,a)}).error(function(){c&&c("load dob violations fails")})}else c&&c("bble is missing")},this.getECBViolations=function(b,c){if(b){var d="/api/ConstructionCases/GetECBViolations?bble="+b;a.get(d).success(function(a){c&&c(null,a)}).error(function(){c&&c("load ecb violations fails")})}}}]).service("ptTime",[function(){this.isPassByDays=function(a,b,c){var d=new Date(a),e=new Date(b),f=864e5,g=e.getTime()-d.getTime(),h=g/f;return h>c?!0:!1},this.isPassOrEqualByDays=function(a,b,c){var d=new Date(a),e=new Date(b),f=864e5,g=e.getTime()-d.getTime(),h=g/f;return h>=c?!0:!1},this.isLessOrEqualByDays=function(a,b,c){var d=new Date(a),e=new Date(b),f=864e5,g=e.getTime()-d.getTime(),h=g/f;return h>=0&&c>=h?!0:!1},this.isPassByMonths=function(a,b,c){var d=new Date(a),e=new Date(b),f=12*(e.getFullYear()-d.getFullYear())+e.getMonth()-d.getMonth();return f>c?!0:!1},this.isPassOrEqualByMonths=function(a,b,c){var d=new Date(a),e=new Date(b),f=12*(e.getFullYear()-d.getFullYear())+e.getMonth()-d.getMonth();return f>=c?!0:!1}}]).service("ptContactServices",["$http","limitToFilter",function(a,b){var c,d;!function(){c||a.get("/Services/ContactService.svc/LoadContacts").success(function(a,b){c=a}).error(function(a,b){c=[]}),d||a.get("/Services/TeamService.svc/GetAllTeam").success(function(a,b){d=a}).error(function(a,b){d=[]})}(),this.getAllContacts=function(){return c?c:a.get("/Services/ContactService.svc/LoadContacts").then(function(a){return b(a.data,10)})},this.getContacts=function(c,d){return d=void 0===d?null:d,a.get("/Services/ContactService.svc/GetContacts?args="+c).then(function(a){return d?b(a.data.filter(function(a){return a.GroupId==d}),10):b(a.data,10)})},this.getContactsByID=function(d){return c?c.filter(function(a){return a.ContactId==key}):a.get("/Services/ContactService.svc/GetAllContacts?id="+d).then(function(a){return b(a.data,10)})},this.getContactsByGroup=function(a){return c?c.filter(function(b){return b.GroupId==a}):void 0},this.getContact=function(a,b){return c?c.filter(function(c){return c.Name&&b?c.ContactId==a&&c.Name.trim().toLowerCase()===b.trim().toLowerCase():void 0})[0]||{}:{}},this.getContactById=function(a){return c?c.filter(function(b){return b.ContactId==a})[0]:null},this.getContactByName=function(a){return c?c.filter(function(b){return b.Name&&a?b.Name.trim().toLowerCase()===a.trim().toLowerCase():void 0})[0]:{}},this.getEntities=function(c,d){return d=void 0===d?"Available":d,c=c?"":c,a.get("/Services/ContactService.svc/GetCorpEntityByStatus?n="+c+"&s="+d).then(function(a){return b(a.data,10)})},this.getTeamByName=function(a){return d?d.filter(function(b){return b.Name&&a?b.Name.trim()==a.trim():void 0})[0]:{}}}]).service("ptShortsSaleService",["$http",function(a){this.getShortSaleCase=function(b,c){var d="/ShortSale/ShortSaleServices.svc/GetCase?caseId="+b;a.get(d).success(function(a){c(a)}).error(function(a){console.log("Get Short sale failed CaseId= "+b+", error : "+JSON.stringify(a))})},this.getShortSaleCaseByBBLE=function(b,c){var d="/ShortSale/ShortSaleServices.svc/GetCaseByBBLE?bble="+b;a.get(d).success(function(a){c(a)}).error(function(){console.log("Get Short Sale By BBLE fails.")})},this.getBuyerTitle=function(b,c){var d="/api/ShortSale/GetBuyerTitle?bble=";a.get(d+b).then(function(a){c&&c(null,a)},function(){c&&c("Fail to get buyer title for bble: "+b,null)})}}]).service("ptLeadsService",["$http",function(a){this.getLeadsByBBLE=function(b,c){var d="/ShortSale/ShortSaleServices.svc/GetLeadsInfo?bble="+b;a.get(d).success(function(a){c(a)}).error(function(a){console.log("Get Short sale Leads failed BBLE ="+b+" error : "+JSON.stringify(a))})}}]).factory("ptHomeBreakDownService",["$http",function(a){return{loadByBBLE:function(b,c){var d="/ShortSale/ShortSaleServices.svc/LoadHomeBreakData?bble="+b;a.get(d).success(function(a){c(a)}).error(function(){console.log("load home breakdown fail. BBLE: "+b)})},save:function(b,c,d){var e="/ShortSale/ShortSaleServices.svc/SaveBreakData",f={bble:b,jsonData:JSON.stringify(c)};a.post(e,f).success(function(a){d(a)}).error(function(){console.log("save home breakdone fail. BBLE: "+b)})}}}]).factory("ptLegalService",function(){return{load:function(a,b){var c="/LegalUI/LegalUI.aspx/GetCaseData",d={bble:a};$.ajax({type:"POST",url:c,data:JSON.stringify(d),dataType:"json",contentType:"application/json",success:function(a){b(null,a)},error:function(){b("load data fails")}})},savePreQuestions:function(a,b,c,d){var e="/LegalUI/LegalServices.svc/StartNewLegalCase",f={bble:a,casedata:JSON.stringify({PreQuestions:c}),createBy:b};$.ajax({type:"POST",url:e,data:JSON.stringify(f),dataType:"json",contentType:"application/json",success:function(a){d(null,a)},error:function(){d("load data fails")}})}}}).factory("ptEntityService",["$http",function(a){return{getEntityByBBLE:function(b,c){var d="/api/CorporationEntities/ByBBLE?BBLE="+b;a.get(d).then(function(a){c&&c(null,a.data)},function(a){c&&c("load fail",a.data)})}}}]),angular.module("PortalApp").filter("ByContact",function(){return function(a,b){var c={out:[]};return $.isEmptyObject(b)||null===b.Type?a:(angular.forEach(a,function(a,d){a.Type===b.Type&&(""===b.CorpName||b.CorpName===a.CorpName)&&c.out.push(a)}),c.out)}}).filter("unsafe",["$sce",function(a){return a.trustAsHtml}]),angular.module("PortalApp").directive("ssDate",function(){return{restrict:"A",scope:!0,compile:function(a,b){return{post:function(a,b,c){$(b).datepicker({forceParse:!1}),a.$watch(c.ngModel,function(a,c){var d=a;if(d&&"string"==typeof d&&d.indexOf("T")>-1){var e=new Date(d);e=e.getUTCMonth()+1+"/"+e.getUTCDate()+"/"+e.getUTCFullYear(),$(b).datepicker("update",new Date(e))}})}}}}}).directive("ptRightClick",["$parse",function(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}]).directive("inputMask",function(){return{restrict:"A",link:function(a,b,c){$(b).mask(c.inputMask),$(b).on("change",function(){a.$eval(c.ngModel+"='"+b.val()+"'")})}}}).directive("bindId",["ptContactServices",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(d.bindId,function(c,e){if(c!==e){var f=a.getContactById(c);f&&b.$eval(d.ngModel+"='"+f.Name+"'")}})}}}]).directive("ptInitModel",function(){return{restrict:"A",require:"?ngModel",priority:99,link:function(a,b,c){a.$watch(c.ptInitModel,function(b){!a.$eval(c.ngModel)&&b&&("string"==typeof b&&(b=b.replace(/'/g,"\\'")),a.$eval(c.ngModel+"='"+b+"'"))})}}}).directive("ptInitBind",function(){return{restrict:"A",require:"?ngBind",link:function(a,b,c){a.$watch(c.ptInitBind,function(b){!a.$eval(c.ngBind)&&b&&("string"==typeof b&&(b=b.replace(/'/g,"\\'")),a.$eval(c.ngBind+"='"+b+"'"))})}}}).directive("radioInit",function(){return{restrict:"A",link:function(a,b,c){a.$eval(c.ngModel+"="+c.ngModel+"==null?"+c.radioInit+":"+c.ngModel),a.$watch(c.ngModel,function(){var b=a.$eval(c.ngModel);b=null!=b&&("true"==b||1==b),a.$eval(c.ngModel+"="+b.toString())})}}}).directive("moneyMask",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.ngModel,function(){$(b).is(":focus")||$(b).formatCurrency()}),$(b).on("blur",function(){$(this).formatCurrency()}),$(b).on("focus",function(){$(this).toNumber()})}}}).directive("numberMask",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.ngModel,function(){$(b).is(":focus")||$(b).formatCurrency({symbol:""})}),$(b).on("blur",function(){$(this).formatCurrency({symbol:""})}),$(b).on("focus",function(){$(this).toNumber()})}}}).directive("integerMask",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.ngModel,function(){$(b).is(":focus")||$(b).formatCurrency({symbol:"",roundToDecimalPlace:0})}),$(b).on("blur",function(){$(this).formatCurrency({symbol:"",roundToDecimalPlace:0})}),$(b).on("focus",function(){$(this).toNumber()})}}}).directive("percentMask",function(){return{restrict:"A",link:function(a,b,c){a.$watch(c.ngModel,function(){$(b).is(":focus")||$(b).formatCurrency({symbol:"%",positiveFormat:"%n%s"})}),$(b).on("blur",function(){$(this).formatCurrency({symbol:"%",positiveFormat:"%n%s"})}),$(b).on("focus",function(){$(this).toNumber()})}}}).directive("ptRadio",function(){return{restrict:"E",template:'<input type="checkbox" id="{{name}}Y" ng-model="model" class="ss_form_input"><label for="{{name}}Y" class="input_with_check"><span class="box_text">{{trueValue}}&nbsp</span></label><input type="checkbox" id="{{name}}N" ng-model="model" ng-true-value="false" ng-false-value="true" class="ss_form_input"><label for="{{name}}N" class="input_with_check"><span class="box_text">{{falseValue}}&nbsp</span></label>',scope:{model:"=",name:"@",defaultValue:"@",trueValue:"@",falseValue:"@"},link:function(a,b,c){a.trueValue=a.trueValue?a.trueValue:"yes",a.falseValue=a.falseValue?a.falseValue:"no",a.defaultValue="true"===a.defaultValue?!0:!1,a.model=null==a.model?a.defaultValue:a.model}}}).directive("ptCollapse",function(){return{restrict:"E",template:'<i class="fa fa-compress icon_btn text-primary" ng-show="!model" ng-click="model=!model"></i><i class="fa fa-expand icon_btn text-primary" ng-show="model" ng-click="model=!model"></i>',scope:{model:"="},link:function(a,b,c){var d=a.model;a.model=void 0===d?!1:d}}}).directive("ckEditor",[function(){return{require:"?ngModel",link:function(a,b,c,d){var e=CKEDITOR.replace(b[0],{allowedContent:!0,height:450});e.on("pasteState",function(){a.$apply(function(){d.$setViewValue(e.getData())})}),d.$render=function(a){e.setData(d.$modelValue)}}}}]).directive("ptAdd",function(){return{restrict:"E",template:'<i class="fa fa-plus-circle icon_btn text-primary tooltip-examples" title="Add"></i>'}}).directive("ptDel",function(){return{restrict:"E",template:'<i class="fa fa-times icon_btn text-danger tooltip-examples" title="Delete"></i>'}}).directive("ptFile",["ptFileService","$timeout",function(a,b){return{restrict:"E",templateUrl:"/js/templates/ptfile.html",scope:{fileModel:"=",fileBble:"=",fileName:"@",fileId:"@",uploadType:"@"},link:function(c,d,e){c.uploadType=c.uploadType||"construction",c.ptFileService=a,c.fileChoosed=!1,c.loading=!1,c.delFile=function(){c.fileModel=null},c.delChoosed=function(){c.File=null,c.fileChoosed=!1;var a=d.find("input:file")[0];a.value=""},c.toggleLoading=function(){c.loading=!c.loading},c.startLoading=function(){c.loading=!0},c.stopLoading=function(){b(function(){c.loading=!1})},c.uploadFile=function(){c.startLoading();var b=new FormData;b.append("file",c.File);var d=a.getFileName(c.File.name);a.uploadFile(b,c.fileBble,d,"",c.uploadType,function(b,d){c.stopLoading(),b?alert(b):c.$apply(function(){c.fileModel={},c.fileModel.path=d[0],d[1]&&(c.fileModel.thumb=d[1]),c.fileModel.name=a.getFileName(c.fileModel.path),c.fileModel.uploadTime=new Date,c.delChoosed()})})},d.find("input:file").bind("change",function(){var a=this.files[0];a&&c.$apply(function(){c.File=a,c.fileChoosed=!0})}),c.modifyName=function(b){b&&(c.ModifyNamePop=!0,c.NewFileName=b.name?b.name:"",c.editingFileModel=b,c.editingFileExt=a.getFileExt(c.NewFileName))},c.onModifyNamePopClose=function(){c.NewFileName="",c.editingFileModel=null,c.editingFileExt="",c.ModifyNamePop=!1},c.onModifyNamePopSave=function(){c.NewFileName&&(c.NewFileName.indexOf(".")>-1?c.editingFileModel.name=c.NewFileName:c.editingFileModel.name=c.NewFileName+"."+c.editingFileExt),c.editingFileModel=null,c.editingFileExt="",c.ModifyNamePop=!1}}}}]).directive("ptFiles",["$timeout","ptFileService","ptCom",function(a,b,c){return{restrict:"E",templateUrl:"/js/templates/ptfiles.html",scope:{fileModel:"=",fileBble:"=",fileId:"@",fileColumns:"@",folderEnable:"@",baseFolder:"@",uploadType:"@"},link:function(d,e,f){d.ptFileService=b,d.ptCom=c,d.files=[],d.columns=[],d.nameTable=[],d.currentFolder="",d.showFolder=!1,d.uploadType=d.uploadType||"construction",d.loading=!1,d.baseFolder=d.baseFolder?d.baseFolder:"",d.count=0,d.fileColumns&&(d.columns=d.fileColumns.split("|"),_.each(d.columns,function(a){a.trim()})),d.folders=_.without(_.uniq(_.pluck(d.fileModel,"folder")),void 0,""),d.$watch("fileModel",function(){d.currentFolder="",d.baseFolder=d.baseFolder?d.baseFolder:"",d.folders=_.without(_.uniq(_.pluck(d.fileModel,"folder")),void 0,"")}),$(e).find("input:file").change(function(){var a=this.files;d.addFiles(a),this.value=""}),$(e).find(".drop-area").on("dragenter",function(a){a.preventDefault(),$(this).addClass("drop-area-hover")}).on("dragover",function(a){a.preventDefault(),$(this).addClass("drop-area-hover")}).on("dragleave",function(a){$(this).removeClass("drop-area-hover")}).on("drop",function(a){a.stopPropagation(),a.preventDefault(),$(this).removeClass("drop-area-hover"),d.OnDropTextarea(a)}),d.OnDropTextarea=function(a){if(a.originalEvent.dataTransfer){var b=a.originalEvent.dataTransfer.files;d.addFiles(b)}else alert("Your browser does not support the drag files.")},d.changeFolder=function(a){d.currentFolder=a,d.showFolder=!0},d.addFolder=function(a){d.folders.indexOf(a)<0&&d.folders.push(a),d.currentFolder=a,d.showFolder=!0},d.hideFolder=function(){d.currentFolder="",d.showFolder=!1},d.toggleNewFilePop=function(){d.NewFolderPop=!d.NewFolderPop,d.NewFolderName=""},d.newFolderPopSave=function(){d.addFolder(d.NewFolderName),d.NewFolderPop=!1},d.addFiles=function(a){for(var b=0;b<a.length;b++){var c=a[b];d.$apply(function(){d.nameTable.indexOf(c.name)<0&&(d.files.push(c),d.nameTable.push(c.name))})}},d.removeChoosed=function(a){d.nameTable.splice(d.nameTable.indexOf(d.files[a].name),1),d.files.splice(a,1)},d.clearChoosed=function(){d.nameTable=[],d.files=[]},d.showUpoading=function(){d.uploadProcess=!0,d.dynamic=1},d.hideUpoading=function(){d.clearChoosed(),d.uploadProcess=!1},d.showUploadErrors=function(){var a=_.some(d.result,function(a){return a.error});return!d.uploading&&a},d.uploadFile=function(){var a=(d.baseFolder?d.baseFolder+"/":"")+(d.currentFolder?d.currentFolder+"/":""),c=d.files.length;d.fileModel=d.fileModel?d.fileModel:[],d.result=[],d.showUpoading(),d.uploading=!0;for(var e=0;c>e;e++){var f={};f.name=b.getFileName(d.files[e].name),f.folder=d.currentFolder,f.uploadTime=new Date;for(var g=0;g<d.columns.length;g++){var h=d.columns[g];f[h]=""}d.result.push(f)}for(var e=0;c>e;e++){var i=new FormData;i.append("file",d.files[e]);var j=b.getFileName(d.files[e].name);b.uploadFile(i,d.fileBble,j,a,d.uploadType,function(a,b,e){var f;a?(d.countCallback(c),f=_.filter(d.result,function(a){return a.name==e})[0],f&&(f.error=a)):(d.countCallback(c),f=_.filter(d.result,function(a){return a.name==e})[0],f&&(f.path=b[0],b[1]&&(f.thumb=b[1])),d.fileModel.push(f))})}},d.countCallback=function(b){a(d.count>=b-1?function(){d.count=d.count+1,d.dynamic=Math.floor(d.count/b*100),d.count=0,d.uploading=!1,d.clearChoosed()}:function(){d.count=d.count+1,d.dynamic=Math.floor(d.count/b*100)})},d.modifyName=function(a,c){a[c]&&(d.ModifyNamePop=!0,d.NewFileName=a[c].name?a[c].name:"",d.editingFileModel=a,d.editingIndx=c,d.editingFileExt=b.getFileExt(d.NewFileName))},d.onModifyNamePopClose=function(){d.NewFileName="",d.editingFileModel=null,d.editingIndx=null,d.ModifyNamePop=!1,d.editingFileExt=""},d.onModifyNamePopSave=function(){d.NewFileName&&(d.NewFileName.indexOf(".")>-1?d.editingFileModel[d.editingIndx].name=d.NewFileName:d.editingFileModel[d.editingIndx].name=d.NewFileName+"."+d.editingFileExt),d.editingFileModel=null,d.editingIndx=null,d.ModifyNamePop=!1,d.editingFileExt=""},d.getThumb=function(a){return a&&a.thumb?b.getThumb(a.thumb):"/images/no_image.jpg"},d.fancyPreview=function(a){b.isPicture(a.name)&&$.fancybox.open(b.makePreviewUrl(a.path))},d.filterError=function(a){return a.error}}}}]).directive("ptLink",["ptFileService",function(a){return{restrict:"E",scope:{ptModel:"="},template:'<a ng-click="onFilePreview(ptModel.path)">{{trunc(ptModel.name,20)}}</a>',link:function(b,c,d){b.onFilePreview=a.onFilePreview,b.trunc=a.trunc}}}]).directive("ptFinishedMark",[function(){return{restrict:"E",template:'<span ng-if="ssStyle==0"><button type="button" class="btn btn-default" ng-show="!ssModel" ng-click="confirm()">{{text1?text1:"Confirm"}}</button><button type="button" class="btn btn-success" ng-show="ssModel" ng-dblclick="deconfirm()">{{text2?text2:"Complete"}}&nbsp<i class="fa fa-check-circle"></i></button></span><span ng-if="ssStyle==1"><span class="label label-default" ng-show="!ssModel" ng-click="confirm()">{{text1?text1:"Confirm"}}</span><span class="label label-success" ng-show="ssModel" ng-dblclick="deconfirm()">{{text2?text2:"Complete"}}&nbsp<i class="fa fa-check-circle"></i></span></span>',scope:{ssModel:"=",text1:"@",text2:"@",ssStyle:"@"},link:function(a,b,c){a.ssModel||(a.ssModel=!1),a.ssStyle&&"label"===a.ssStyle.toLowerCase()?a.ssStyle=1:a.ssStyle=0,a.confirm=function(){a.ssModel=!0},a.deconfirm=function(){a.ssModel=!1}}}}]),angular.module("PortalApp").controller("BuyerEntityCtrl",["$scope","$http","ptContactServices",function(a,b,c){a.EmailTo=[],a.EmailCC=[],a.ptContactServices=c,a.selectType="All Entities",a.loadPanelVisible=!0,a.encodeURIComponent=window.encodeURIComponent,b.get("/Services/ContactService.svc/GetAllBuyerEntities").success(function(b){a.CorpEntites=b,a.currentContact=a.CorpEntites[0],a.loadPanelVisible=!1}).error(function(a){alert("Get All buyers Entities error : "+JSON.stringify(a))}),b.get("/Services/TeamService.svc/GetAllTeam").success(function(b){a.AllTeam=b}).error(function(a){alert("Get All Team name  error : "+JSON.stringify(a))}),a.Groups=[{GroupName:"All Entities"},{GroupName:"Available"},{GroupName:"Assigned Out"},{GroupName:"Current Offer",SubGroups:[{GroupName:"NHA Current Offer"},{GroupName:"Isabel Current Offer"},{GroupName:"Quiet Title Action"},{GroupName:"Deed Purchase"},{GroupName:"Straight Sale"},{GroupName:"Jay Current Offer"}]},{GroupName:"Sold",SubGroups:[{GroupName:"Purchased"},{GroupName:"Partnered"},{GroupName:"Sold (Final Sale)/Recyclable"}]},{GroupName:"In House"},{GroupName:"Agent Corps"}],a.ChangeGroups=function(b){a.selectType=b},a.GetTitle=function(){return(a.SelectedTeam?""===a.SelectedTeam?"All Team's ":a.SelectedTeam+"s ":"")+a.selectType},a.ExportExcel=function(){JSONToCSVConvertor(a.filteredCorps,!0,a.GetTitle())},a.GroupCount=function(b){if(!a.CorpEntites)return 0;if("All Entities"==b.GroupName)return a.SelectedTeam?a.CorpEntites.filter(function(b){return b.Office&&b.Office.toLowerCase().trim()==a.SelectedTeam.toLowerCase().trim()}).length:a.CorpEntites.length;var c=0;if(b.SubGroups){for(var d=0;d<b.SubGroups.length;d++)c+=a.GroupCount(b.SubGroups[d]);return c}var e=a.CorpEntites.filter(function(a){return a.Status&&a.Status.toLowerCase().trim()==b.GroupName.toLowerCase().trim()});return a.SelectedTeam&&(e=e.filter(function(b){return b.Office&&b.Office.toLowerCase().trim()==a.SelectedTeam.toLowerCase().trim()})),e.length},a.lookupDataSource=new DevExpress.data.ODataStore({url:"/odata/LeadsInfoes",key:"CategoryID",keyType:"Int32"}),a.TeamCount=function(b){if(!a.CorpEntites)return 0;var c=[];return c=b?a.CorpEntites.filter(function(a){return a.Office&&a.Office.toLowerCase().trim()==b.toLowerCase().trim()}):a.CorpEntites,a.selectType&&a.selectType!=a.Groups[0].GroupName&&(c=c.filter(function(b){return b.Status&&b.Status.toLowerCase().trim()==a.selectType.toLowerCase().trim()})),c.length},a.EmployeeDataSource=function(){var b=a.ptContactServices.getContactsByGroup(4),c=new DevExpress.data.CustomStore({load:function(a){if(a.searchValue){var c=a.searchValue;return b.filter(function(a){a.Email&&(a.Email.toLowerCase()==c.toLowerCase()||a.Name.toLowerCase()==c.toLowerCase())}).slice(0,10)}return b.slice(0,10)},byKey:function(a,b){}});return{dataSource:c,searchEnabled:!0,placeholder:"Type to Search",displayExpr:"Email",valueExpr:"Email",bindingOptions:{values:"EmailTo"}}},a.EntitiesFilter=function(b){if("All Entities"==a.selectType||b.Status&&a.selectType.toLowerCase().trim()==b.Status.toLowerCase().trim())return!0;var c=a.Groups.filter(function(b){return b.GroupName==a.selectType})[0];if(c&&c.SubGroups)for(var d=0;d<c.SubGroups.length;d++){var e=c.SubGroups[d];if(b.Status&&e.GroupName.toLowerCase().trim()==b.Status.toLowerCase().trim())return!0}return!1},a.selectCurrent=function(b){a.currentContact=b},a.SaveCurrent=function(){a.loadPanelVisible=!0,b.post("/Services/ContactService.svc/SaveCorpEntitiy",{c:JSON.stringify(a.currentContact)}).success(function(b,c,d,e){a.loadPanelVisible=!1,alert("Save succeed!")}).error(function(b,c,d,e){alert("Get error save corp entitiy : "+JSON.stringify(b)),a.loadPanelVisible=!1})},a.AllGroups=function(){for(var b=a.Groups.filter(function(a){return null!=a.SubGroups}),c=[],d=0;d<b.length;d++)c=c.concat(b[d].SubGroups);var e=a.Groups.filter(function(a){return null==a.SubGroups&&"All Entities"!=a.GroupName});return c=c.concat(e)},a.addContactFunc=function(){a.loadPanelVisible=!0,b.post("/Services/ContactService.svc/SaveCorpEntitiy",{c:JSON.stringify(a.addContact)}).success(function(b,c,d,e){return a.loadPanelVisible=!1,b?(a.currentContact=b,a.CorpEntites.push(a.addContact),void alert("Add entity succeed !")):void alert("Already have a entitity named "+a.addContact.CorpName+"! please pick other name")}).error(function(b,c,d,e){a.loadPanelVisible=!1,alert("Add buyer Entities error : "+JSON.stringify(b))})},a.AssginEntity=function(){a.loadPanelVisible=!0,b.post("/Services/ContactService.svc/AssginEntity",{c:JSON.stringify(a.currentContact)}).success(function(b,c,d,e){a.loadPanelVisible=!1,a.currentContact.BBLE=b,alert("Assigned succeed !")}).error(function(b,c,d,e){a.loadPanelVisible=!1,alert("Can not find BBLE of address:("+a.currentContact.PropertyAssigned+") Please make sure this address is available")})},a.ChangeTeam=function(b){a.SelectedTeam=b},a.OpenLeadsView=function(){var b=a.currentContact.BBLE,c="/ViewLeadsInfo.aspx?id="+b;OpenLeadsWindow(c,"View Leads Info "+b)},a.UploadFile=function(b,c,d){a.loadPanelVisible=!0;var e=a.currentContact,f=e.EntityId,g=document.getElementById(b).files[0];$.ajax({url:"/services/ContactService.svc/UploadFile?id="+f+"&type="+c,type:"POST",data:g,cache:!1,dataType:"json",processData:!1,contentType:"application/octet-stream",success:function(b){alert("successful.."),a.currentContact[d]=b,a.loadPanelVisible=!1,a.$apply()},error:function(b){alert("Some error Occurred!"),a.loadPanelVisible=!1,a.$apply()}})}}]),angular.module("PortalApp").controller("ConstructionCtrl",["$scope","$http","$interpolate","ptCom","ptContactServices","ptEntityService","ptShortsSaleService","ptLeadsService","ptConstructionService",function(a,b,c,d,e,f,g,h,i){var j=function(){this.CSCase={InitialIntake:{},Photos:{},Utilities:{Company:[],Insurance_Type:[]},Violations:{DOBViolations:[],ECBViolations:[]},ProposalBids:{},Plans:{},Contract:{},Signoffs:{},Comments:[]}},k=function(){this.intake={count:0,finished:0},this.signoff={count:0,finished:0},this.construction={count:0,finished:0},this.test={count:0,finished:0}};a._=_,a.ReloadedData={},a.CSCase=new j,a.percentage=new k,a.UTILITY_SHOWN={ConED:"CSCase.CSCase.Utilities.ConED_Shown","Energy Service":"CSCase.CSCase.Utilities.EnergyService_Shown","National Grid":"CSCase.CSCase.Utilities.NationalGrid_Shown",DEP:"CSCase.CSCase.Utilities.DEP_Shown","MISSING Water Meter":"CSCase.CSCase.Utilities.MissingMeter_Shown",Taxes:"CSCase.CSCase.Utilities.Taxes_Shown",ADT:"CSCase.CSCase.Utilities.ADT_Shown",Insurance:"CSCase.CSCase.Utilities.Insurance_Shown"},a.HIGHLIGHTS=[{message:"Plumbing signed off at {{CSCase.CSCase.Signoffs.Plumbing_SignedOffDate}}",criteria:"CSCase.CSCase.Signoffs.Plumbing_SignedOffDate"},{message:"Electrical signed off at {{CSCase.CSCase.Signoffs.Electrical_SignedOffDate}}",criteria:"CSCase.CSCase.Signoffs.Electrical_SignedOffDate"},{message:"Construction signed off at {{CSCase.CSCase.Signoffs.Construction_SignedOffDate}}",criteria:"CSCase.CSCase.Signoffs.Construction_SignedOffDate"},{message:"HPD Violations has all finished",criteria:"CSCase.CSCase.Violations.HPD_OpenHPDViolation === false"}],a.WATCHED_MODEL=[{model:"CSCase.CSCase.Signoffs.Plumbing_SignedOffDate",backedModel:"ReloadedData.Backed_Plumbing_SignedOffDate",info:"Plumbing Sign Off Date"},{model:"CSCase.CSCase.Signoffs.Construction_SignedOffDate",backedModel:"ReloadedData.Backed_Construction_SignedOffDate",info:"Construction Sign Off Date"},{model:"CSCase.CSCase.Signoffs.Electrical_SignedOffDate",backedModel:"ReloadedData.Electrical_SignedOffDate",info:"Electrical Sign Off Date"}],a.arrayRemove=d.arrayRemove,a.ptContactServices=e,a.ensurePush=function(b,c){d.ensurePush(a,b,c);
},a.getRunnerList=function(){var c="/api/ConstructionCases/GetRunners";b.get(c).then(function(b){b.data&&(a.RUNNER_LIST=b.data)})}(),a.setPopupVisible=function(b,c){a.$eval(b+"="+c)},a.reload=function(){a.ReloadedData={},a.CSCase=new j,a.ensurePush("CSCase.CSCase.Utilities.Floors",{FloorNum:"?",ConED:{},EnergyService:{},NationalGrid:{}}),a.percentage=new k,a.clearWarning()},a.init=function(b,c){d.startLoading(),b=b.trim(),a.reload();var e,j,k,l;i.getConstructionCases(b,function(b){d.nullToUndefined(b),$.extend(!0,a.CSCase,b),a.initWatchedModel(),e=!0,e&&j&&k&l&&(d.stopLoading(),c&&c())}),g.getShortSaleCaseByBBLE(b,function(b){a.SsCase=b,j=!0,e&&j&&k&l&&(d.stopLoading(),c&&c())}),h.getLeadsByBBLE(b,function(b){a.LeadsInfo=b,k=!0,e&&j&&k&l&&(d.stopLoading(),c&&c())}),f.getEntityByBBLE(b,function(b,f){f?a.EntityInfo=f:(a.EntityInfo={},console.log(b)),l=!0,e&&j&&k&l&&(d.stopLoading(),c&&c())})},a.ChangeStatus=function(a,c){b.post("/api/ConstructionCases/ChangeStatus/"+leadsInfoBBLE,c).success(function(){a?a():d.alert("Successed !")}).error(function(a,b){d.alert("Fail to save data. status "+b+"Error : "+JSON.stringify(a))})},a.saveCSCase=function(){var b=angular.toJson(a.CSCase);i.saveConstructionCases(a.CSCase.BBLE,b,function(b){ScopeSetLastUpdateTime(a.GetTimeUrl()),d.alert("Save successfully!")}),a.updateInitialFormOwner(),a.checkWatchedModel()},a.$watch("CSCase.CSCase.Utilities.Company",function(b){if(b){var c=a.UTILITY_SHOWN,d=a.CSCase.CSCase.Utilities.Company;_.each(d,function(b,d){a.$eval(c[b]+"=false")}),_.each(b,function(b,d){a.$eval(c[b]+"=true")})}},!0),a.$watch("CSCase.CSCase.Utilities.ConED_EnergyServiceRequired",function(b){if(b)a.CSCase.CSCase.Utilities.Company.indexOf("Energy Service")<0&&(a.CSCase.CSCase.Utilities.Company.push("Energy Service"),a.ReloadedData.EnergyService_Collapsed=!1);else{var c=a.CSCase.CSCase.Utilities.Company.indexOf("Energy Service");-1!==c&&a.CSCase.CSCase.Utilities.Company.splice(c,1)}}),a.sendNotice=function(a,b){confirm("Send Intake Sheet To "+b+" ?")},a.showPopover=function(a){aspxConstructionCommentsPopover.ShowAtElement(a.target)},a.addComment=function(b){var c={};c.comment=b,c.caseId=a.CaseId,c.createBy=Current_User,c.createDate=new Date,a.CSCase.CSCase.Comments.push(c)},a.addCommentFromPopup=function(){var b=a.addCommentTxt;a.addComment(b),a.addCommentTxt=""},a.activeTab="CSInitialIntake",a.updateActive=function(b){a.activeTab=b},a.isHighlight=function(b){return a.$eval(b)},a.highlightMsg=function(b){var d=c(b)(a);return d},a.initWatchedModel=function(){_.each(a.WATCHED_MODEL,function(b,c){a.$eval(b.backedModel+"="+b.model)})},a.checkWatchedModel=function(){var b="";_.each(a.WATCHED_MODEL,function(c,d){a.$eval(c.backedModel+"!="+c.model)&&(a.$eval(c.backedModel+"="+c.model),b+=c.info+" changes to "+a.$eval(c.model)+".<br>")}),b&&AddActivityLog(b)},a.HeaderEditing=!1,a.toggleHeaderEditing=function(b){a.HeaderEditing=!a.HeaderEditing,b&&$("#ConstructionTitleInput").focus()},a.addNewDOBViolation=function(){a.ensurePush("CSCase.CSCase.Violations.DOBViolations"),a.setPopupVisible("ReloadedData.DOBViolations_PopupVisible_"+(a.CSCase.CSCase.Violations.DOBViolations.length-1),!0)},a.addNewECBViolation=function(){a.ensurePush("CSCase.CSCase.Violations.ECBViolations"),a.setPopupVisible("ReloadedData.ECBViolations_PopupVisible_"+(a.CSCase.CSCase.Violations.ECBViolations.length-1),!0)},a.fetchDOBViolations=function(){d.confirm("<h3 style='color:red'>Warning!!!</h3>Getting information from DOB takes a while.<br>And it will <b>REPLACE</b> your current Data, are you sure to continue?","Warning").then(function(b){b&&i.getDOBViolations(a.CSCase.BBLE,function(b,c){b?(d.alert(b),console.log(b)):d.confirm("<h3 style='color:red'>Warning!!!</h3>Your current DOB Violation data will be replaced.","Warning").then(function(b){b&&(c&&c.DOB_TotalDOBViolation&&(a.CSCase.CSCase.Violations.DOB_TotalDOBViolation=c.DOB_TotalDOBViolation),c&&c.DOB_TotalOpenViolations&&(a.CSCase.CSCase.Violations.DOB_TotalOpenViolations=c.DOB_TotalOpenViolations),c&&c.violations&&(a.CSCase.CSCase.Violations.DOBViolations=c.violations))})})})},a.fetchECBViolations=function(){d.confirm("<h3 style='color:red'>Warning!!!</h3>Getting information from DOB takes a while.<br>And it will <b>REPLACE</b> your current Data, are you sure to continue?","Warning").then(function(b){b&&i.getECBViolations(a.CSCase.BBLE,function(b,c){b?(d.alert(b),console.log(b)):d.confirm("<h3 style='color:red'>Warning!!!</h3>Your current DOB Violation data will be replaced.","Warning").then(function(b){b&&(c&&c.ECP_TotalViolation&&(a.CSCase.CSCase.Violations.ECP_TotalViolation=c.ECP_TotalViolation),c&&c.ECP_TotalOpenViolations&&(a.CSCase.CSCase.Violations.ECP_TotalOpenViolations=c.ECP_TotalOpenViolations),c&&c.violations&&(a.CSCase.CSCase.Violations.ECBViolations=_.filter(c.violations,function(a,b){return"OPEN"==a.DOBViolationStatus.slice(0,4)})))})})})},a.test=a.checkIntake,a.intakeComplete=function(){a.checkIntake(function(a){a.prev().css("background-color","yellow")})?d.alert("Intake Complete Fails.\nPlease check highlights for missing information!"):(a.CSCase.IntakeCompleted=!0,AddActivityLog("Intake Process have finished!"),a.saveCSCase())},a.checkIntake=function(b){a.clearWarning(),a.percentage.intake.count=0,a.percentage.intake.finished=0,$(".intakeCheck").each(function(c){var d,e=$(this).attr("ng-model")||$(this).attr("ss-model")||$(this).attr("file-model")||$(this).attr("model");e&&("floor"===e.slice(0,4)?(d=_.has($(this).scope().floor,e.split(".").splice(1).join(".")),d?a.percentage.intake.finished++:b&&b($(this))):(d=a.$eval(e),void 0===d?b&&b($(this)):a.percentage.intake.finished++)),a.percentage.intake.count++});var c=a.percentage.intake.count-a.percentage.intake.finished;return c},a.clearWarning=function(){$(".intakeCheck").each(function(a){$(this).prev().css("background-color","transparent")})},a.updatePercentage=function(){a.checkIntake()},a.GetTimeUrl=function(){return a.CSCase.BBLE?"/api/ConstructionCases/LastLastUpdate/"+a.CSCase.BBLE:""},a.GetCSCaseId=function(){return a.CSCase.BBLE},a.GetModifyUserUrl=function(){return"/api/ConstructionCases/LastModifyUser/"+a.CSCase.BBLE},a.printWindow=function(){window.open("/Construction/ConstructionPrint.aspx?bble="+a.CSCase.BBLE,"Print","width=1024, height=800")},a.openInitialForm=function(){window.open("/Construction/ConstructionInitialForm.aspx?bble="+a.CSCase.BBLE,"Initial Form","width=1280, height=960")},a.openBudgetForm=function(){window.open("/Construction/ConstructionBudgetForm.aspx?bble="+a.CSCase.BBLE,"Budget Form","width=1024, height=768")},a.updateInitialFormOwner=function(){var c="/api/ConstructionCases/UpdateInitialFormOwner?BBLE="+a.CSCase.BBLE+"&owner="+a.CSCase.CSCase.InitialIntake.InitialFormAssign;b({method:"POST",url:c}).then(function(a){console.log("Assign Initial Form owner Success.")},function(a){console.log("Fail to assign Initial Form owner.")})},a.getOrdersLength=function(){}}]),angular.module("PortalApp").controller("LegalCtrl",["$scope","$http","ptContactServices","ptCom","ptTime",function(b,c,d,e,f){b.ptContactServices=d,b.ptCom=e,b.isPassByDays=f.isPassByDays,b.isPassOrEqualByDays=f.isPassOrEqualByDays,b.isLessOrEqualByDays=f.isLessOrEqualByDays,b.isPassByMonths=f.isPassByMonths,b.isPassOrEqualByMonths=f.isPassOrEqualByMonths,b.LegalCase={PropertyInfo:{},ForeclosureInfo:{},SecondaryInfo:{},PreQuestions:{}},b.LegalCase.SecondaryInfo.StatuteOfLimitations=[],b.LegalCase.SecondaryTypes=[],b.SecondaryTypeSource=["Statute Of Limitations","Estate","Miscellaneous","Deed Reversal","Partition","Breach of Contract","Quiet Title",""],b.TestRepeatData=[],("undefined"==typeof LegalShowAll||null==LegalShowAll)&&(b.LegalCase.SecondaryInfo.SelectTypes=b.SecondaryTypeSource),b.filterSelected=!0,b.LegalCase.ForeclosureInfo.PlaintiffId=638,b.PickedContactId=null,b.querySearch=function(a){var c=function(a){var b=angular.lowercase(a);return function(a){return a.Name&&-1!==a.Name.toLowerCase().indexOf(b)}},d=a?b.allContacts.filter(c(a)):[];return d},b.loadContacts=function(){var a=AllContact?AllContact:[];return a.map(function(a,b){return a.image="https://storage.googleapis.com/material-icons/external-assets/v1/icons/svg/ic_account_circle_black_48px.svg",a.Name&&(a._lowername=a.Name.toLowerCase()),a})},b.allContacts=b.loadContacts(),b.contacts=[b.allContacts[0]],b.AllJudges=AllJudges?AllJudges:[],b.addTest=function(){b.TestRepeatData[b.TestRepeatData.length]=b.TestRepeatData.length},b.RoboSingerDataSource=new DevExpress.data.DataSource({store:new DevExpress.data.CustomStore({load:function(a){return AllRoboSignor?a.searchValue?AllRoboSignor.filter(function(b){return b.Name?b.Name.toLowerCase().indexOf(a.searchValue.toLowerCase())>=0:!1}):[]:void 0},byKey:function(a){return AllRoboSignor?AllRoboSignor.filter(function(b){return b.ContactId==a})[0]:void 0},searchExpr:["Name"]})}),b.InitContact=function(a,c){return{dataSource:c?b[c]:b.ContactDataSource,valueExpr:"ContactId",displayExpr:"Name",searchEnabled:!0,minSearchLength:2,noDataText:"Please input to search",bindingOptions:{value:a}}},b.TestContactId=function(a){b.$eval(a+"=192")},b.GetContactById=function(a){return AllContact.filter(function(b){return b.ContactId==a})[0]},b.CheckPlace=function(a){return a?"NY"===a:!1},b.SaveLegal=function(a){if(!LegalCaseBBLE||LegalCaseBBLE!==leadsInfoBBLE)return void alert("Case not load completed please wait!");var d=JSON.stringify(b.LegalCase),e={bble:LegalCaseBBLE,caseData:d};c.post("LegalUI.aspx/SaveCaseData",e).success(function(){a?a():(b.LogSaveChange(),alert("Save Successed !")),ResetCaseDataChange()}).error(function(a,b){alert("Fail to save data. status "+b+"Error : "+JSON.stringify(a))})},b.CompleteResearch=function(){var a=JSON.stringify(b.LegalCase),d={bble:leadsInfoBBLE,caseData:a,sn:taskSN};c.post("LegalUI.aspx/CompleteResearch",d).success(function(){alert("Submit Success!"),"undefined"!=typeof gridTrackingClient&&gridTrackingClient.Refresh()}).error(function(a){alert("Fail to save data :"+JSON.stringify(a)),console.log(a)})},b.BackToResearch=function(a){var d=JSON.stringify(b.LegalCase),e={bble:leadsInfoBBLE,caseData:d,sn:taskSN,comments:a};c.post("LegalUI.aspx/BackToResearch",e).success(function(){alert("Submit Success!"),"undefined"!=typeof gridTrackingClient&&gridTrackingClient.Refresh()}).error(function(a){alert("Fail to save data :"+JSON.stringify(a)),console.log(a)})},b.CloseCase=function(a){var b={bble:leadsInfoBBLE,comments:a};c.post("LegalUI.aspx/CloseCase",b).success(function(){alert("Submit Success!"),"undefined"!=typeof gridTrackingClient&&gridTrackingClient.Refresh()}).error(function(a){alert("Fail to save data :"+JSON.stringify(a)),console.log(a)})},b.AttorneyComplete=function(){var a=JSON.stringify(b.LegalCase),d={bble:leadsInfoBBLE,caseData:a,sn:taskSN};c.post("LegalUI.aspx/AttorneyComplete",d).success(function(){alert("Submit Success!"),"undefined"!=typeof gridTrackingClient&&gridTrackingClient.Refresh()}).error(function(){alert("Fail to save data.")})},b.LogSaveChange=function(){for(var a in b.LogChange){var c=b.LogChange[a],d=c.old,e=c.now();if(d!=e){var f="#LealCaseStatusData",g=$(f+' option[value="'+d+'"]').html(),h=$(f+' option[value="'+e+'"]').html();g?AddActivityLog(c.msg+g+" to "+h):AddActivityLog(c.msg.replace(" from","")+" to "+h),b.LogChange[a].old=e}}},b.LoadLeadsCase=function(d){e.startLoading();var f={bble:d};c.post("LegalUI.aspx/GetCaseData",f).success(function(c,f,g,h){b.LegalCase=$.parseJSON(c.d),b.LegalCase.BBLE=d,b.LegalCase.LegalComments=b.LegalCase.LegalComments||[],b.LegalCase.ForeclosureInfo=b.LegalCase.ForeclosureInfo||{},b.LogChange={TaxLienFCStatus:{old:b.LegalCase.TaxLienFCStatus,now:function(){return b.LegalCase.TaxLienFCStatus},msg:"Tax Lien FC Status changed from "},CaseStauts:{old:b.LegalCase.CaseStauts,now:function(){return b.LegalCase.CaseStauts},msg:"Mortgae foreclosure Status changed from "}};var i=["AffidavitOfServices","Assignments","MembersOfEstate"];for(a in i){var j=i[a],k=b.LegalCase.ForeclosureInfo[j];k&&0!==k.length||(b.LegalCase.ForeclosureInfo[j]=[],b.LegalCase.ForeclosureInfo[j].push({}))}b.LegalCase.SecondaryTypes=b.LegalCase.SecondaryTypes||[],b.showSAndCFrom(),LegalCaseBBLE=d,e.stopLoading(),ResetCaseDataChange(),CaseNeedComment=!0}).error(function(){e.stopLoading(),alert("Fail to load data : "+d)}),c.get("/ShortSale/ShortSaleServices.svc/GetCaseByBBLE?bble="+d).success(function(a){b.ShortSaleCase=a}).error(function(){alert("Fail to Short sale case  data : "+d)});var g="/ShortSale/ShortSaleServices.svc/GetLeadsInfo?bble="+d;c.get(g).success(function(a){b.LeadsInfo=a,b.LPShow=b.ModelArray("LeadsInfo.LisPens")}).error(function(a){alert("Get Short Sale Leads failed BBLE ="+d+" error : "+JSON.stringify(a))}),c.get("/api/TaxLiens/"+d).success(function(a){b.TaxLiens=a,b.TaxLiensShow=b.ModelArray("TaxLiens")}).error(function(a){alert("Get Tax Liens failed BBLE = "+d+" error : "+JSON.stringify(a))}),c.get("/api/LegalECourtByBBLE/"+d).success(function(a){b.LegalECourt=a}).error(function(){b.LegalECourt=null})},b.ModelArray=function(a){var c=b.$eval(a);return c&&c.length>0?"Yes":""},b.HighLightFunc=function(a){a.split(",")},b.AddSecondaryArray=function(){var a=b.LegalCase.SecondaryInfo.SelectedType;if(a){var c=a.replace(/\s/g,""),d=b.LegalCase.SecondaryInfo[c];"StatuteOfLimitations"===c&&alert("match"),d&&Array.isArray(b.LegalCase.SecondaryInfo[c])||(b.LegalCase.SecondaryInfo[c]=[]),b.LegalCase.SecondaryInfo[c].push({})}},b.LegalCase.SecondaryInfo.SelectedType=b.SecondaryTypeSource[0],b.SecondarySelectType=function(){b.LegalCase.SecondaryInfo.SelectTypes=b.LegalCase.SecondaryInfo.SelectTypes||[];var a=b.LegalCase.SecondaryInfo.SelectTypes;_.contains(a,b.LegalCase.SecondaryInfo.SelectedType)||a.push(b.LegalCase.SecondaryInfo.SelectedType)},b.CheckShow=function(a){return"undefined"==typeof LegalShowAll||null===LegalShowAll?!0:b.LegalCase.SecondaryInfo?b.LegalCase.SecondaryInfo.SelectedType==a:!1},b.SaveLegalJson=function(){b.LegalCaseJson=JSON.stringify(b.LegalCase)},b.ShowContorl=function(a){var b=typeof a;return"string"===b?"true"===a:a},b.DocGenerator=function(a){b.LegalCase.SecondaryInfo||(b.LegalCase.SecondaryInfo={});var c=[{tplName:"OSCTemplate.docx",data:{Plantiff:b.LegalCase.ForeclosureInfo.Plantiff,PlantiffAttorney:b.LegalCase.ForeclosureInfo.PlantiffAttorney,PlantiffAttorneyAddress:b.LegalCase.ForeclosureInfo.PlantiffAttorneyAddress,FCFiledDate:b.LegalCase.ForeclosureInfo.FCFiledDate,FCIndexNum:b.LegalCase.ForeclosureInfo.FCIndexNum,BoroughName:b.LeadsInfo.BoroughName,Block:b.LeadsInfo.Block,Lot:b.LeadsInfo.Lot,Defendant:b.LegalCase.SecondaryInfo.Defendant,Defendants:b.LegalCase.SecondaryInfo.OSC_Defendants?","+b.LegalCase.SecondaryInfo.OSC_Defendants.map(function(a){return a.Name}).join(","):" ",DefendantAttorneyName:b.LegalCase.SecondaryInfo.DefendantAttorneyName,DefendantAttorneyPhone:d.getContact(b.LegalCase.SecondaryInfo.DefendantAttorneyId,b.LegalCase.SecondaryInfo.DefendantAttorneyName).OfficeNO,DefendantAttorneyAddress:d.getContact(b.LegalCase.SecondaryInfo.DefendantAttorneyId,b.LegalCase.SecondaryInfo.DefendantAttorneyName).Address,CourtAddress:b.GetCourtAddress(b.LeadsInfo.Borough),PropertyAddress:b.LeadsInfo.PropertyAddress}},{tplName:"DeedReversionTemplate.docx",data:{Plantiff:b.LegalCase.SecondaryInfo.DeedReversionPlantiff,PlantiffAttorney:b.LegalCase.SecondaryInfo.DeedReversionPlantiffAttorney,PlantiffAttorneyAddress:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.DeedReversionPlantiffAttorneyId,b.LegalCase.SecondaryInfo.DeedReversionPlantiffAttorney).Address,PlantiffAttorneyPhone:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.DeedReversionPlantiffAttorneyId,b.LegalCase.SecondaryInfo.DeedReversionPlantiffAttorney).OfficeNO,IndexNum:b.LegalCase.SecondaryInfo.DeedReversionIndexNum||" ",BoroughName:b.LeadsInfo.BoroughName,Block:b.LeadsInfo.Block,Lot:b.LeadsInfo.Lot,Defendant:b.LegalCase.SecondaryInfo.DeedReversionDefendant,Defendants:b.LegalCase.SecondaryInfo.DeedReversionDefendants?","+b.LegalCase.SecondaryInfo.DeedReversionDefendants.map(function(a){return a.Name}).join(","):" ",CourtAddress:b.GetCourtAddress(b.LeadsInfo.Borough),PropertyAddress:b.LeadsInfo.PropertyAddress}},{tplName:"SpecificPerformanceComplaintTemplate.docx",data:{Plantiff:b.LegalCase.SecondaryInfo.SPComplaint_Plantiff,PlantiffAttorney:b.LegalCase.SecondaryInfo.SPComplaint_PlantiffAttorney,PlantiffAttorneyAddress:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.SPComplaint_PlantiffAttorneyId,b.LegalCase.SecondaryInfo.SPComplaint_PlantiffAttorney).Address,PlantiffAttorneyPhone:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.SPComplaint_PlantiffAttorneyId,b.LegalCase.SecondaryInfo.SPComplaint_PlantiffAttorney).OfficeNO,IndexNum:b.LegalCase.SecondaryInfo.SPComplaint_IndexNum||" ",BoroughName:b.LeadsInfo.BoroughName,Block:b.LeadsInfo.Block,Lot:b.LeadsInfo.Lot,Defendant:b.LegalCase.SecondaryInfo.SPComplaint_Defendant,Defendants:b.LegalCase.SecondaryInfo.SPComplaint_Defendants?","+b.LegalCase.SecondaryInfo.SPComplaint_Defendants.map(function(a){return a.Name}).join(","):" ",CourtAddress:b.GetCourtAddress(b.LeadsInfo.Borough),PropertyAddress:b.LeadsInfo.PropertyAddress}},{tplName:"QuietTitleComplantTemplate.docx",data:{Plantiff:b.LegalCase.SecondaryInfo.QTA_Plantiff,PlantiffAttorney:b.LegalCase.SecondaryInfo.QTA_PlantiffAttorney,PlantiffAttorneyAddress:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.QTA_PlantiffAttorneyId,b.LegalCase.SecondaryInfo.QTA_PlantiffAttorney).Address,PlantiffAttorneyPhone:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.QTA_PlantiffAttorneyId,b.LegalCase.SecondaryInfo.QTA_PlantiffAttorney).OfficeNO,OriginalMortgageLender:b.LegalCase.SecondaryInfo.QTA_OrgMorgLender,Mortgagee:b.LegalCase.SecondaryInfo.QTA_Mortgagee,IndexNum:b.LegalCase.SecondaryInfo.QTA_IndexNum||" ",BoroughName:b.LeadsInfo.BoroughName,Block:b.LeadsInfo.Block,Lot:b.LeadsInfo.Lot,Defendant:b.LegalCase.SecondaryInfo.QTA_Defendant,Defendant2:b.LegalCase.SecondaryInfo.QTA_Defendant2,Defendants:b.LegalCase.SecondaryInfo.QTA_Defendants?","+b.LegalCase.SecondaryInfo.QTA_Defendants.map(function(a){return a.Name}).join(","):" ",CourtAddress:b.GetCourtAddress(b.LeadsInfo.Borough),PropertyAddress:b.LeadsInfo.PropertyAddress,FCFiledDate:b.LegalCase.ForeclosureInfo.FCFiledDate,FCIndexNum:b.LegalCase.ForeclosureInfo.FCIndexNum,DefaultDate:b.LegalCase.ForeclosureInfo.QTA_DefaultDate,DeedToPlaintiffDate:b.LegalCase.SecondaryInfo.QTA_DeedToPlaintiffDate}},{tplName:"Partition_Temp.docx",data:{Plantiff:b.LegalCase.SecondaryInfo.PartitionsPlantiff,PlantiffAttorney:b.LegalCase.SecondaryInfo.PartitionsPlantiffAttorney,PlantiffAttorneyAddress:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.PartitionsPlantiffAttorneyId,b.LegalCase.SecondaryInfo.PartitionsPlantiffAttorney).Address,PlantiffAttorneyPhone:b.ptContactServices.getContact(b.LegalCase.SecondaryInfo.PartitionsPlantiffAttorneyId,b.LegalCase.SecondaryInfo.PartitionsPlantiffAttorney).OfficeNO,OriginalMortgageLender:b.LegalCase.SecondaryInfo.PartitionsOriginalLender,MortgageDate:b.LegalCase.SecondaryInfo.PartitionsMortgageDate,IndexNum:b.LegalCase.SecondaryInfo.PartitionsIndexNum||" ",BoroughName:b.LeadsInfo.BoroughName,Block:b.LeadsInfo.Block,Lot:b.LeadsInfo.Lot,Defendant:b.LegalCase.SecondaryInfo.PartitionsDefendant,Defendant1:b.LegalCase.SecondaryInfo.PartitionsDefendant1,PropertyAddress:b.LeadsInfo.PropertyAddress,MortgageAmount:b.LegalCase.SecondaryInfo.PartitionsMortgageAmount,DateOfRecording:b.LegalCase.SecondaryInfo.PartitionsDateOfRecording,CRFN:b.LegalCase.SecondaryInfo.PartitionsCRFN,OriginalLender:b.LegalCase.SecondaryInfo.PartitionsOriginalLender}}],f=c.filter(function(b){return b.tplName==a})[0];if(f){for(var g in f.data){var h=f.data[g];if(!h)return void alert("Some data missing please check "+g+"Please check!")}e.DocGenerator(f.tplName,f.data,function(a){STDownloadFile(a,f.tplName.replace("Template",""))})}else alert("can find tlp "+a)},b.CheckSecondaryTags=function(a){return b.LegalCase.SecondaryTypes.filter(function(b){return b==a})[0]},b.GetCourtAddress=function(a){var b=["","851 Grand Concourse Bronx, NY 10451","360 Adams St. Brooklyn, NY 11201","8811 Sutphin Boulevard, Jamaica, NY 11435"];return b[a-1]},b.hSummery=[{Name:"CaseStauts",CallFunc:"HighLightStauts(LegalCase.CaseStauts,4)",Description:"Last milestone document recorded on Clerk Minutes after O/REF. ",ArrayName:""},{Name:"EveryOneIn",CallFunc:"LegalCase.ForeclosureInfo.WasEstateFormed != null",Description:"There is an estate.",ArrayName:""},{Name:"BankruptcyFiled",CallFunc:"LegalCase.ForeclosureInfo.BankruptcyFiled == true",Description:"Bankruptcy filed",ArrayName:""},{Name:"Efile",CallFunc:"LegalCase.ForeclosureInfo.Efile == true",Description:"Has E-filed",ArrayName:""},{Name:"EfileN",CallFunc:"LegalCase.ForeclosureInfo.Efile == false",Description:"No E-filed",ArrayName:""},{Name:"ClientPersonallyServed",CallFunc:"false",Description:"Client personally is not served. ",ArrayName:"AffidavitOfServices"},{Name:"NailAndMail",CallFunc:"true",Description:"Nail and Mail.",ArrayName:"AffidavitOfServices"},{Name:"BorrowerLiveInAddrAtTimeServ",CallFunc:"false",Description:"Borrower didn't live in service Address at time of Serv.",ArrayName:"AffidavitOfServices"},{Name:"BorrowerEverLiveHere",CallFunc:"false",Description:"Borrower didn't ever live in service address.",ArrayName:"AffidavitOfServices"},{Name:"ServerInSererList",CallFunc:"true",Description:"process server is in server list.",ArrayName:"AffidavitOfServices"},{Name:"isServerHasNegativeInfo",CallFunc:"true",Description:"Web search provide any negative information on process server. ",ArrayName:"AffidavitOfServices"},{Name:"AffidavitServiceFiledIn20Day",CallFunc:"false",Description:"Affidavit of service wasn't file within 20 days of service.",ArrayName:"AffidavitOfServices"},{Name:"AnswerClientFiledBefore",CallFunc:"LegalCase.ForeclosureInfo.AnswerClientFiledBefore == false",Description:"Client hasn't ever filed an answer before.",ArrayName:""},{Name:"NoteIsPossess",CallFunc:"LegalCase.ForeclosureInfo.NoteIsPossess == false",Description:"We Don't possess a copy of the note.",ArrayName:""},{Name:"NoteEndoresed",CallFunc:"LegalCase.ForeclosureInfo.NoteEndoresed == false",Description:"Note wasn't endores.",ArrayName:""},{Name:"NoteEndorserIsSignors",CallFunc:"LegalCase.ForeclosureInfo.NoteEndorserIsSignors == true",Description:"The endorser is in signors list.",ArrayName:""},{Name:"HasDocDraftedByDOCXLLC",CallFunc:"true",Description:"There are documents drafted by DOCX LLC .",ArrayName:"Assignments"},{Name:"LisPendesRegDate",CallFunc:"isPassOrEqualByDays(LegalCase.ForeclosureInfo.LisPendesDate, LegalCase.ForeclosureInfo.LisPendesRegDate, 5)",Description:"Date of registration 5 days after Lis Pendens letter",ArrayName:""},{Name:"AccelerationLetterMailedDate",CallFunc:"isPassOrEqualByMonths(LegalCase.ForeclosureInfo.DefaultDate,LegalCase.ForeclosureInfo.AccelerationLetterMailedDate,12 )",Description:"Acceleration letter mailed to borrower after 12 months of Default Date. ",ArrayName:""},{Name:"AccelerationLetterRegDate",CallFunc:"isPassOrEqualByDays(LegalCase.ForeclosureInfo.AccelerationLetterMailedDate,LegalCase.ForeclosureInfo.AccelerationLetterRegDate,3 )",Description:"Date of registration for Acceleration letter filed  3 days after acceleration letter mailed date",ArrayName:""},{Name:"AffirmationFiledDate",CallFunc:"isPassByDays(LegalCase.ForeclosureInfo.JudgementDate,LegalCase.ForeclosureInfo.AffirmationFiledDate,0)",Description:"Affirmation filed after Judgement. ",ArrayName:""},{Name:"AffirmationReviewerByCompany",CallFunc:"LegalCase.ForeclosureInfo.AffirmationReviewerByCompany == false",Description:"The affirmation reviewer wasn't employe by the servicing company. ",ArrayName:""},{Name:"MortNoteAssInCert",CallFunc:"LegalCase.ForeclosureInfo.MortNoteAssInCert == false",Description:"In the Certificate of Merit, the Mortgage, Note and Assignment aren't included. ",ArrayName:""},{Name:"MissInCert",CallFunc:"checkMissInCertValue()",Description:"Mortgage Note or Assignment are missing. ",ArrayName:""},{Name:"CertificateReviewerByCompany",CallFunc:"LegalCase.ForeclosureInfo.CertificateReviewerByCompany == false",Description:"The certificate  reviewer wasn't employe by the servicing company. ",ArrayName:""},{Name:"LegalCase.ItemsRedacted",CallFunc:"LegalCase.ForeclosureInfo.ItemsRedacted == false",Description:"Are items of personal information Redacted.",ArrayName:""},{Name:"RJIDate",CallFunc:"isPassByMonths(LegalCase.ForeclosureInfo.SAndCFiledDate, LegalCase.ForeclosureInfo.RJIDate, 12)",Description:"RJI filed after 12 months of S&C.",ArrayName:""},{Name:"ConferenceDate",CallFunc:"isLessOrEqualByDays(LegalCase.ForeclosureInfo.RJIDate, LegalCase.ForeclosureInfo.ConferenceDate, 60)",Description:"Conference date scheduled 60 days before RJI",ArrayName:""},{Name:"OREFDate",CallFunc:"isPassByMonths(LegalCase.ForeclosureInfo.RJIDate, LegalCase.ForeclosureInfo.OREFDate, 12)",Description:"O/REF filed after 12 months after RJI.",ArrayName:""},{Name:"JudgementDate",CallFunc:"isPassByMonths(LegalCase.ForeclosureInfo.RJIDate, LegalCase.ForeclosureInfo.OREFDate, 12)",Description:"Judgement submitted 12 months after O/REF. ",ArrayName:""}],b.evalVisible=function(a){var c=!1;return a.ArrayName?b.LegalCase.ForeclosureInfo[a.ArrayName]&&angular.forEach(b.LegalCase.ForeclosureInfo[a.ArrayName],function(b,d){c=c||b[a.Name]==("true"===a.CallFunc)}):c=b.$eval(a.CallFunc),c},angular.forEach(b.hSummery,function(a,c){b.$watch(function(){return b.evalVisible(a)},function(b){a.visible=b})}),b.GetCaseInfo=function(){var a={Name:"",Address:""},c=b.LegalCase.CaseName;if(c){a.Address=c.replace(/-(?!.*-).*$/,"");var d=c.match(/-(?!.*-).*$/);d&&d[0]&&(a.Name=d[0].replace("-",""))}return a},b.AddArrayItem=function(a){a=a||[],a.push({})},b.DeleteItem=function(a,b){a.splice(b,1)},b.isLess08292013=!1,b.isBigger08302013=!1,b.isBigger03012015=!1,b.showSAndCFormFlag=!1,b.showSAndCFrom=function(){var a=new Date(b.LegalCase.ForeclosureInfo.SAndCFiledDate);a-new Date("08/29/2013")>0?b.isLess08292013=!1:b.isLess08292013=!0,b.isLess08292013?b.isBigger08302013=!1:b.isBigger08302013=!0,a-new Date("03/01/2015")>0?b.isBigger03012015=!0:b.isBigger03012015=!1,b.showSAndCFormFlag=b.isLess08292013|b.isBigger08302013|b.isBigger03012015},b.HighLightStauts=function(a,b){return parseInt(a)>b?!0:!1},b.addToEstateMembers=function(a){b.LegalCase.ForeclosureInfo.MembersOfEstate.push({id:a,name:b.LegalCase.membersText}),b.LegalCase.membersText=""},b.delEstateMembers=function(a){b.LegalCase.ForeclosureInfo.MembersOfEstate.splice(a,1)},b.ShowECourts=function(a){c.post("/CallBackServices.asmx/GetBroughName",{bro:b.LegalCase.PropertyInfo.Borough}).success(function(c){var d=["http://bronxcountyclerkinfo.com/law/UI/User/lne.aspx"," http://iapps.courts.state.ny.us/kcco/"," https://iapps.courts.state.ny.us/qcco/"],e=d[a-2],f=b.LegalCase.CaseName,g=" (Brough: "+c.d+" Block: "+b.LegalCase.PropertyInfo.Block+" Lot: "+b.LegalCase.PropertyInfo.Lot+")";ShowPopupMap(e,f,g)})},b.missingItems=[{id:1,label:"Mortgage"},{id:2,label:"Note"},{id:3,label:"Assignment"}],b.updateMissInCertValue=function(a){b.LegalCase.ForeclosureInfo.MissInCert=a},b.checkMissInCertValue=function(){return b.LegalCase.ForeclosureInfo.MortNoteAssInCert?!1:b.LegalCase.ForeclosureInfo.MissInCert&&0!=b.LegalCase.ForeclosureInfo.MissInCert.length?!1:!0},b.initMissInCert=function(){return{dataSource:b.missingItems,valueExpr:"id",displayExpr:"label",onValueChanged:function(a){a.model.updateMissInCertValue(a.values)}}},b.ShowAddPopUp=function(a){b.addCommentTxt="",aspxAddLeadsComments.ShowAtElement(a.target)},b.SaveLegalComments=function(){b.LegalCase.LegalComments.push({id:b.LegalCase.LegalComments.length+1,Comment:b.addCommentTxt}),b.SaveLegal(function(){console.log("ADD comments"+b.addCommentTxt),aspxAddLeadsComments.Hide()})},b.DeleteComments=function(a){b.LegalCase.LegalComments.splice(a,1),b.SaveLegal(function(){console.log("Deleted comments")})},b.AddActivityLog=function(){"function"==typeof AddActivityLog&&AddActivityLog(b.MustAddedComment)},b.CheckWorkHours=function(){c.get("/api/WorkingLogs/Legal/"+b.LegalCase.BBLE).success(function(a){b.TotleHours=a,$("#WorkPopUp").modal()})}}]),angular.module("PortalApp").controller("ReportWizardCtrl",function(a,b,c,d){a.camel=_.camelCase,a.step=1,a.collpsed=[],a.CurrentQuery=null,a.reload=function(c){a.step=1,a.CurrentQuery=null,b.get(CUSTOM_REPORT_TEMPLATE).then(function(b){a.Fields=b.data[0].Fields,a.BaseTable=b.data[0].BaseTable,a.IncludeAppId=b.data[0].IncludeAppId,c&&c()}),a.loadSavedReport()},a.loadSavedReport=function(){b.get("/api/Report/Load").then(function(b){a.SavedReports=b.data})},a.deleteSavedReport=function(c){var d=confirm("Are you sure to delete?");d&&(c.ReportId?b({method:"DELETE",url:"/api/Report/Delete/"+c.ReportId}).then(function(b){a.reload(),alert("Delete Success.")}):alert("Delete Fails!"))},a.load=function(c){a.reload(function(){c.ReportId&&b.get("/api/Report/Load/"+c.ReportId).then(function(b){var c=b.data;a.CurrentQuery=c,a.Fields=JSON.parse(c.Query),a.generate();var d=JSON.parse(c.Layout);$("#queryReport").dxDataGrid("instance").state(d)})})},a.someCheck=function(a){return _.some(a.fields,{checked:!0})},a.addFilter=function(a){a.filters||(a.filters=[]),a.filters.push({})},a.removeFilter=function(a,b){a.filters.splice(b,1)},a.updateStringFilter=function(a){if(!a.criteria||!a.input1)return a.WhereTerm="",a.CompareOperator="",void(a.value1="");switch(a.criteria){case"1":a.WhereTerm="CreateCompare",a.CompareOperator="Like",a.value1=a.input1.trim()+"%";break;case"2":a.WhereTerm="CreateCompare",a.CompareOperator="Like",a.value1="%"+a.input1.trim();break;case"3":a.WhereTerm="CreateCompare",a.CompareOperator="Like",a.value1="%"+a.input1.trim()+"%";break;default:a.WhereTerm="",a.CompareOperator="",a.value1=""}},a.updateDateFilter=function(a){if(!a.criteria||!a.input1)return a.WhereTerm="",a.CompareOperator="",void(a.value1="");switch(a.criteria){case"1":a.WhereTerm="CreateCompare",a.CompareOperator="Less",a.value1=a.input1;break;case"2":a.WhereTerm="CreateCompare",a.CompareOperator="Greater",a.value1=a.input1;break;case"3":a.WhereTerm="CreateCompare",a.CompareOperator="Equal",a.value1=a.input1;break;default:a.WhereTerm="",a.CompareOperator="",a.value1=""}},a.updateNumberFilter=function(a){if(!a.criteria||!a.input1||"5"==a.criteria&&!a.input2)return a.WhereTerm="",a.CompareOperator="",a.value1="",void(a.value2="");switch(a.criteria){case"1":a.WhereTerm="CreateCompare",a.CompareOperator="Less",a.value1=a.input1.trim(),a.value2="";break;case"2":a.WhereTerm="CreateCompare",a.CompareOperator="LessOrEqual",a.value1=a.input1.trim(),a.value2="";break;case"3":a.WhereTerm="CreateCompare",a.CompareOperator="Greater",a.value1=a.input1.trim(),a.value2="";break;case"4":a.WhereTerm="CreateCompare",a.CompareOperator="GreaterOrEqual",a.value1=a.input1.trim(),a.value2="";break;case"5":a.WhereTerm="CreateBetween",a.CompareOperator="",a.value1=a.input1.trim(),a.value2=a.input2.trim();break;default:a.WhereTerm="",a.CompareOperator="",a.value1="",a.value2=""}},a.updateListFilter=function(a){!a.input1||a.input1.length<1?(a.WhereTerm="",a.CompareOperator="",a.value1=""):(a.WhereTerm="CreateIn",a.CompareOperator="",a.value1=a.input1)},a.updateBooleanFilter=function(a){if(a.input1)switch(a.input1){case"1":a.WhereTerm="CreateCompare",a.CompareOperator="Equal",a.value1=!0;break;case"0":a.WhereTerm="CreateCompare",a.CompareOperator="Equal",a.value1=!1;break;default:a.WhereTerm="",a.CompareOperator="",a.value1=""}else a.WhereTerm="",a.CompareOperator="",a.value1=""},a.onSaveQueryPopCancel=function(){a.NewQueryName="",a.SaveQueryPop=!1},a.onSaveQueryPopSave=function(){if(a.NewQueryName){var c={};c.Name=a.NewQueryName,c.Query=JSON.stringify(a.Fields),c.sqlText=a.sqlText,c.Layout=JSON.stringify($("#queryReport").dxDataGrid("instance").state()),c=JSON.stringify(c),b({method:"POST",url:"/api/Report/Save",
data:c}).then(function(b){a.NewQueryName="",a.SaveQueryPop=!1,a.reload(),alert("Save successful!")})}else alert("New query name is empty!"),a.NewQueryName="",a.SaveQueryPop=!1},a.update=function(){var c=a.CurrentQuery;c.Query=JSON.stringify(a.Fields),c.sqlText=a.sqlText,c.Layout=JSON.stringify($("#queryReport").dxDataGrid("instance").state()),c=JSON.stringify(c),b({method:"POST",url:"/api/Report/Save",data:c}).then(function(b){a.NewQueryName="",a.SaveQueryPop=!1,a.reload(),alert("Save successful!")})},a.isBindColumn=function(a){return a.table&&a.column?!0:!1},a.next=function(){a.step=a.step+1},a.prev=function(){a.step=a.step-1},a.filterDate=function(a){var b=/\d{4}-\d{2}-\d{2}/;a&&_.each(a,function(a,c){a&&_.forOwn(a,function(c,e){c&&"string"==typeof c&&c.match(b)&&(a[e]=d.toUTCLocaleDateString(c))})})},a.generate=function(){var c=[],d=a.BaseTable?a.BaseTable:"",e=a.IncludeAppId?a.IncludeAppId:"";_.each(a.Fields,function(a,b){_.each(a.fields,function(a,b){a.checked&&c.push(a)})}),c.length>0?(a.step=3,b({method:"POST",url:"/api/Report/QueryData?baseTable="+d+"&includeAppId="+e,data:JSON.stringify(c)}).then(function(b){var c=b.data[0];a.filterDate(c),a.reportData=c,a.sqlText=b.data[1]})):alert("Query is empty!")},a.reload()}),angular.module("PortalApp").controller("ShortSaleCtrl",["$scope","$http","$timeout","ptContactServices","ptCom",function(a,b,c,d,e){a.ptContactServices=d,a.capitalizeFirstLetter=e.capitalizeFirstLetter,a.formatName=e.formatName,a.formatAddr=e.formatAddr,a.ptCom=e,a.MortgageTabs=[],a.SsCase={PropertyInfo:{Owners:[{}]},CaseData:{},Mortgages:[{}]},a.SsCaseApprovalChecklist={},a.Approval_popupVisible=!1,b.get("/Services/ContactService.svc/getbanklist").success(function(b){a.bankNameOptions=b}).error(function(b){a.bankNameOptions=[]}),a.MoveToConstruction=function(c){var d=(a.SsCase,{bble:leadsInfoBBLE});b.post("ShortSaleServices.svc/MoveToConstruction",JSON.stringify(d)).success(function(){c?c():e.alert("Move to Construction successful!")}).error(function(a,b){e.alert("Fail to save data. status :"+b+"Error : "+JSON.stringify(a))})},a.MoveToTitle=function(c){var d=(a.SsCase,{bble:leadsInfoBBLE});b.post("ShortSaleServices.svc/MoveToTitle",JSON.stringify(d)).success(function(){c?c():e.alert("Move to Title successful !")}).error(function(a,b){e.alert("Fail to save data. status "+b+"Error : "+JSON.stringify(a))})},a.GetShortSaleCase=function(c,d){if(!c)return void console.log("Can not find case Id ");e.startLoading();var f,g;b.get("ShortSaleServices.svc/GetCase?caseId="+c).success(function(h){a.SsCase=h,leadsInfoBBLE=a.SsCase.BBLE,window.caseId=c,b.get("ShortSaleServices.svc/GetLeadsInfo?bble="+a.SsCase.BBLE).success(function(b){a.ReloadedData={},a.SsCase.LeadsInfo=b,$("#CaseData").val(JSON.stringify(a.SsCase)),d&&d(),f=!0,f&&g&&e.stopLoading()}).error(function(b){e.stopLoading(),e.alert("Get Short sale Leads failed BBLE ="+a.SsCase.BBLE+" error : "+JSON.stringify(b))}),b.get("/LegalUI/LegalServices.svc/GetLegalCase?bble="+leadsInfoBBLE).success(function(b){a.LegalCase=b,g=!0,f&&g&&e.stopLoading()}).error(function(a){e.stopLoading(),console.log("Fail to load data : "+leadsInfoBBLE+" :"+JSON.stringify(a))})}).error(function(a){e.stopLoading(),e.alert("Get Short sale failed CaseId= "+c+", error : "+JSON.stringify(a))})},a.GetLoadId=function(){return window.caseId},a.GetModifyUserUrl=function(){return"ShortSaleServices.svc/GetModifyUserUrl?caseId="+window.caseId},a.NGAddArraryItem=function(b,c,d){if(c){var e=a.$eval(c);e?a.$eval(c+".push({})"):a.$eval(c+"=[{}]")}else b.push({});d&&a.setVisiblePopup(b[b.length-1],!0)},a.NGremoveArrayItem=function(a,b,c){var d=window.confirm("Delete This?");d&&(c?a[b].DataStatus=3:a.splice(b,1))};var f=["UpdateTime","UpdateDate","UpdateBy","OwnerId","MortgageId","OfferId","ValueId","CallbackDate","LastUpdate"],g=!1;a.AutoSaveShortSale=function(c){var d=a.SsCase,f={caseData:JSON.stringify(d)};b.post("ShortSaleServices.svc/SaveCase",JSON.stringify(f)).success(function(b){g=!1,h(),i(b,a.SsCase),c||e.alert("Save Successed !"),c&&c()}).error(function(a,b){if(!g){g=!0;var c=a&&"object"==typeof a&&a.message?a.message:JSON.stringify(a);e.alert("Error in AutoSave. status "+b+"Error : "+c)}})};var h=function(){_.remove(a.SsCase.Mortgages,{DataStatus:3}),console.log(a.SsCase.Mortgages)},i=function(a,b){var c=b;if(a instanceof Date)return null==c&&(c=new Date),c=new Date,void c.setTime(a.getTime());if(a instanceof Array){null==c&&(c=[]);for(var d=0,e=a.length;e>d;d++)i(a[d],c[d])}else{if(!(a instanceof Object))throw new Error("Unable to copy obj! Its type isn't supported.");null==c&&(c={});for(var g in a)a.hasOwnProperty(g)&&(null==a[g]||"object"!=typeof a[g]?("undefined"==typeof c[g]||null==c[g]||c[g]!=a[g])&&f.indexOf(g)>0&&(c[g]=a[g]):i(a[g],c[g]))}};a.SaveShortSale=function(c){var d=a.SsCase,f={caseData:JSON.stringify(d)};b.post("ShortSaleServices.svc/SaveCase",JSON.stringify(f)).success(function(){a.GetShortSaleCase(a.SsCase.CaseId),c||e.alert("Save Successed !"),c&&c()}).error(function(a,b){var c=a&&"object"==typeof a&&a.message?a.message:JSON.stringify(a);e.alert("Fail to save data. status "+b+"Error : "+c)})},a.ShowAddPopUp=function(b){a.addCommentTxt="",aspxAddLeadsComments.ShowAtElement(b.target)},a.AddComments=function(){b.post("ShortSaleServices.svc/AddComments",{comment:a.addCommentTxt,caseId:a.SsCase.CaseId}).success(function(b){a.SsCase.Comments.push(b)}).error(function(a,b){e.alert("Fail to AddComments. status "+b+"Error : "+JSON.stringify(a))})},a.DeleteComments=function(c){var d=a.SsCase.Comments[c];b.get("ShortSaleServices.svc/DeleteComment?commentId="+d.CommentId).success(function(b){a.SsCase.Comments.splice(c,1)}).error(function(a,b){e.alert("Fail to delete comment. status "+b+"Error : "+JSON.stringify(a))})},a.GetCaseInfo=function(){var b={Name:"",Address:""},c=a.SsCase.CaseName;if(c){b.Address=c.replace(/-(?!.*-).*$/,"");var d=c.match(/-(?!.*-).*$/);d&&d[0]&&(b.Name=d[0].replace("-",""))}return b},a.setVisiblePopup=function(b,c){b&&(b.visiblePopup=c),_.defer(function(){a.$apply()})},a.approvalSave=function(){a.approvalSuccCallback&&a.approvalSuccCallback(),a.SaveShortSale(),a.Approval_popupVisible=!1},a.approvalCancl=function(){a.approvalCanclCallback&&a.approvalCanclCallback(),a.Approval_popupVisible=!1},a.regApproval=function(b,c){a.approvalSuccCallback||(a.approvalSuccCallback=b),a.approvalCanclCallback||(a.approvalCanclCallback=c)},a.toggleApprovalPopup=function(){a.$apply(function(){a.Approval_popupVisible=!a.Approval_popupVisible})},a.ValuationWatchField={Method:"Type of Valuation",DateOfCall:"Date of Call",AgentName:"BPO Agent",AgentPhone:"Agent Phone #",DateOfValue:"Date of Valuation",TimeOfValuation:"Time of Valuation",Access:"Access",IsValuationComplete:"Valuation Completed",DateComplate:"Complete Date"},a.Valuation_popupVisible=!1,a.Valuation_Show_Option=1,a.addPendingValue=function(){a.SsCase.ValueInfoes.push({Pending:!0})},a.removePendingValue=function(b){var c=a.SsCase.ValueInfoes.indexOf(b);a.NGremoveArrayItem(a.SsCase.ValueInfoes,c)},a.ensurePendingValue=function(){var b=!1;_.each(a.SsCase.ValueInfoes,function(a,c){a.Pending&&(b=!0)}),b||a.addPendingValue()},a.setPendingModified=function(){a.oldPendingValues=[],_.each(a.SsCase.ValueInfoes,function(b,c){if(b.Pending){var d={};for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);a.oldPendingValues.push(d)}})},a.checkPendingModified=function(){var b="";return _.each(a.SsCase.ValueInfoes,function(c,d){if(c.Pending){var e=a.oldPendingValues.filter(function(a,b){return a.$$hashKey==c.$$hashKey})[0];if(e)for(var f in c)a.ValuationWatchField[f]&&c[f]!==e[f]&&(b+="Valuation"+d+" <b>"+a.ValuationWatchField[f]+"</b> changes to <b>"+c[f]+"</b><br/>");else for(var f in c)a.ValuationWatchField.hasOwnProperty(f)&&(b+="Valuation"+d+" <b>"+a.ValuationWatchField[f]+"</b> changes to <b>"+c[f]+"</b><br/>")}}),b},a.restorePendingModified=function(){_.remove(a.SsCase.ValueInfoes,function(a,b){return a.Pending}),_.each(a.oldPendingValues,function(b,c){a.SsCase.ValueInfoes.push(b)})},a.valuationCanl=function(){a.restorePendingModified(),a.valuationCanclCallback&&a.valuationCanclCallback(),a.Valuation_popupVisible=!1},a.valuationSave=function(){var b=a.checkPendingModified();a.valuationSuccCallback&&a.valuationSuccCallback(b),a.Valuation_popupVisible=!1},a.valuationCompl=function(b){var c=a.checkPendingModified();a.valuationSuccCallback&&a.valuationSuccCallback(c),b.Pending=!1,a.Valuation_popupVisible=!1},a.regValuation=function(b,c){a.valuationSuccCallback||(a.valuationSuccCallback=b),a.valuationCanclCallback||(a.valuationCanclCallback=c)},a.toggleValuationPopup=function(b){a.$apply(function(){a.Valuation_Show_Option=b,a.setPendingModified(),a.ensurePendingValue(),a.Valuation_popupVisible=!a.Valuation_popupVisible})},a.UpdateMortgageStatus=function(b,d,e){var f=0;switch(b){case"2nd Lien":f=1;break;case"3d Lien":f=2;break;default:f=0}c(function(){a.SsCase.Mortgages[f]&&(a.SsCase.Mortgages[f].Category=e,a.SsCase.Mortgages[f].Status=d)})}}]),angular.module("PortalApp").controller("TitleController",["$scope","$http","ptCom","ptContactServices","ptLeadsService","ptShortsSaleService",function(a,b,c,d,e,f){a.OwnerModel=function(a){this.name=a,this.Mortgages=[{}],this.Lis_Pendens=[{}],this.Judgements=[{}],this.ECB_Notes=[{}],this.PVB_Notes=[{}],this.Bankruptcy_Notes=[{}],this.UCCs=[{}],this.FederalTaxLiens=[{}],this.MechanicsLiens=[{}],this.TaxLiensSaleCerts=[{}],this.VacateRelocationLiens=[{}],this.shownlist=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]},a.FormModel=function(){this.FormData={Comments:[],Owners:[new a.OwnerModel("Prior Owner Liens"),new a.OwnerModel("Current Owner Liens")],preclosing:{ApprovalData:[{}]},docs:{}}},a.StatusList=[{num:0,desc:"Initial Review"},{num:1,desc:"Clearance"}],a.arrayRemove=c.arrayRemove,a.ptCom=c,a.ptContactServices=d,a.ensurePush=function(b,d){c.ensurePush(a,b,d)},a.Form=new a.FormModel,a.ReloadedData={},a.Load=function(b){a.Form=new a.FormModel,a.ReloadedData={},c.nullToUndefined(b),$.extend(!0,a.Form,b),a.Form.FormData.Owners[0].shownlist||(a.Form.FormData.Owners[0].shownlist=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],a.Form.FormData.Owners[1].shownlist=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1]),a.BBLE=b.Tag,a.BBLE&&(e.getLeadsByBBLE(a.BBLE,function(b){a.LeadsInfo=b}),f.getBuyerTitle(a.BBLE,function(b,c){b&&console.log(b),c&&(a.BuyerTitle=c.data)}),a.getStatus(a.BBLE)),a.$broadcast("ownerliens-reload"),a.$broadcast("clearance-reload"),a.$broadcast("titledoc-reload"),a.checkReadOnly(TitleControlReadOnly),a.$apply()},a.Get=function(b){return b&&a.updateBuyerTitle(),a.Form},a.checkReadOnly=function(a){a&&($("#TitleUIContent input").attr("disabled",!0),0==$("#TitleROBanner").length&&$("#title_prioity_content").before("<div class='barner-warning text-center' id='TitleROBanner' >Readonly</div>"))},a.completeCase=function(){1!=a.CaseStatus&&a.BBLE?c.confirm("You are going to complated the case?","").then(function(d){d&&b({method:"POST",url:"/api/Title/Completed",data:JSON.stringify(a.BBLE)}).then(function(){a.CaseStatus=1,a.Form.FormData.CompletedDate=new Date,c.alert("The case have moved to Completed")},function(){})}):a.BBLE&&c.confirm("You are going to uncomplated the case?","").then(function(d){d&&b({method:"POST",url:"/api/Title/UnCompleted",data:JSON.stringify(a.BBLE)}).then(function(){a.CaseStatus=-1,c.alert("Uncomplete case successful")},function(){})})},a.updateCaseStatus=function(){a.CaseStatus&&a.BBLE&&(a.ChangeStatusIsOpen=!1,c.confirm("You are going to change case status?","").then(function(d){d&&b({method:"POST",url:"/api/Title/UpdateStatus?bble="+a.BBLE,data:JSON.stringify(a.CaseStatus)}).then(function(){c.alert("The case status has changed!")},function(){})}))},a.getStatus=function(c){b.get("/api/Title/GetCaseStatus?bble="+c).then(function(b){a.CaseStatus=b.data},function(){a.CaseStatus=-1,console.log("get status error")})},a.generateXML=function(){b({url:"/api/Title/GenerateExcel",method:"POST",data:JSON.stringify(a.Form)}).then(function(a){STDownloadFile("/api/Title/GetGeneratedExcel","titlereport.xlsx")})},a.updateBuyerTitle=function(){var d=!1,e=a.BuyerTitle,f=a.Form.FormData.info;e&&f&&(f.Company!=e.CompanyName&&(e.CompanyName=f.Company,d=!0),f.Title_Num!=e.OrderNumber&&(e.OrderNumber=f.Title_Num,d=!0),c.toUTCLocaleDateString(f.Order_Date)!=c.toUTCLocaleDateString(e.ReportOrderDate)&&(d=!0),e.ReportOrderDate=f.Order_Date,c.toUTCLocaleDateString(f.Confirmation_Date)!=c.toUTCLocaleDateString(e.ConfirmationDate)&&(d=!0),e.ConfirmationDate=f.Confirmation_Date,c.toUTCLocaleDateString(f.Received_Date)!=c.toUTCLocaleDateString(e.ReceivedDate)&&(d=!0),e.ReceivedDate=f.Received_Date,c.toUTCLocaleDateString(f.Initial_Reivew_Date)!=c.toUTCLocaleDateString(e.ReviewedDate)&&(d=!0),e.ReviewedDate=f.Initial_Reivew_Date,d&&b({url:"/api/ShortSale/UpdateBuyerTitle",method:"POST",data:JSON.stringify(e)}).then(function(a){a||console.log("fail to update buyertitle")},function(){console.log("fail to update buyertitle")}))}}]).controller("TitleCommentCtrl",["$scope",function(a){a.showPopover=function(a){aspxConstructionCommentsPopover.ShowAtElement(a.target)},a.addComment=function(b,c){var d={};d.comment=b,d.caseId=a.CaseId,d.createBy=c,d.createDate=new Date,a.Form.FormData.Comments.push(d)},a.addCommentFromPopup=function(b){var c=a.addCommentTxt;a.addComment(c,b),a.addCommentTxt=""},a.$on("titleComment",function(b,c){a.addComment(c.message)})}]).controller("TitleLienCtrl",["$scope","ptCom","$timeout",function(a,b,c){a.Form=a.$parent.Form,a.OwnerLienPopup=[!1,!1],a.reload=function(){a.Form=a.$parent.Form,a.OwnerLienPopup=[!1,!1]},a.setPopVisible=function(b,c,d){a.OwnerLienPopup[d]=!0,b.popStep=c?c:0},a.setPopHide=function(b,c){a.OwnerLienPopup[c]=!1,b.popStep=0},a.showWatermark=function(a){var b=!0;return _.each(a,function(a){b&=!a}),b},a.showNext=function(a){var c=a.popStep;return b.next(a.shownlist,!0,c)>=0},a.next=function(c,d){var e=c.popStep;a.showNext(c)?c.popStep=b.next(c.shownlist,!0,e)+1:a.setPopHide(c,d)},a.showPrevious=function(a){var c=a.popStep;return b.previous(a.shownlist,!0,c)>=0},a.previous=function(c,d){var e=c.popStep;a.showPrevious(c)?c.popStep=b.previous(c.shownlist,!0,e-1)+1:a.setPopHide(c,d)},a.$on("ownerliens-reload",function(b,c){a.reload()}),a.swapOwnerPos=function(b){c(function(){var c=a.Form.FormData.Owners[b];a.Form.FormData.Owners[b]=a.Form.FormData.Owners[b-1],a.Form.FormData.Owners[b-1]=c})}}]).controller("TitleFeeClearanceCtrl",["$scope",function(a){var b=function(){this.data=[{name:"Purchase Price",cost:0,lastupdate:null,note:""},{name:"2nd Lien",cost:0,lastupdate:null,note:""},{name:"Taxes due",cost:0,lastupdate:null,note:""},{name:"Water",cost:0,lastupdate:null,note:""},{name:"Multi Dwelling",cost:0,lastupdate:null,note:""},{name:"PVB",cost:0,lastupdate:null,note:""},{name:"ECBS",cost:0,lastupdate:null,note:""},{name:"Judgments",cost:0,lastupdate:null,note:""},{name:"Taxes on HUD",cost:0,lastupdate:null,note:""},{name:"Water on HUD",cost:0,lastupdate:null,note:""},{name:"HPD on HUD",cost:0,lastupdate:null,note:""},{name:"ECB on hud",cost:0,lastupdate:null,note:""}],this.total=0};a.FormData=a.$parent.Form.FormData,a.FormData.FeeClearance=new b,a.reload=function(){a.FormData=a.$parent.Form.FormData,a.$parent.Form.FormData.FeeClearance?a.FormData.FeeClearance=a.FormData.FeeClearance:a.FormData.FeeClearance=new b},a.updateTotal=function(b){b.lastupdate=new Date;var c=0;_.each(a.FormData.FeeClearance.data,function(a,b){c+=parseFloat(a.cost)?parseFloat(a.cost):0}),a.FormData.FeeClearance.total=c},a.$on("clearance-reload",function(b,c){a.reload()})}]).controller("TitleDocCtrl",["$scope","$http","ptCom",function(a,b,c){a.transferors=[{name:"Ron Borovinsky"},{name:"Jay Gottlieb"},{name:"Princess Simeon"},{name:"Eliezer Herts"},{name:"Magda Brillite"},{name:"Tomer Aronov"},{name:"Moisey Iskhakov"},{name:"Albert Gavriyelov"},{name:"Yvette Guizie"},{name:"Michael Gendin"}],a.data=a.$parent.Form.FormData.docs,a.ReloadedData={},a.generatePackage=function(){$("#generatedDocsLink").hide(),$("#generatedDocWarning").hide(),c.startLoading(),b({url:"/api/Title/GeneratePakcage",method:"POST",data:a.data}).then(function(a){c.stopLoading(),a.data.length>0?$("#generatedDocsLink").show():$("#generatedDocWarning").show()},function(){c.stopLoading(),$("#generatedDocWarning").show()})},a.$on("titledoc-reload",function(b,c){a.data=a.$parent.Form.FormData.docs,a.ReloadedData={}})}]),angular.module("PortalApp").controller("VendorCtrl",["$scope","$http","$element",function(a,b,c){$($("[title]")).tooltip({placement:"bottom"}),a.popAddgroup=function(b){a.AddGroupId=b,$("#AddGroupPopup").modal()},a.AddGroups=function(){b.post("/CallBackServices.asmx/AddGroups",{gid:a.AddGroupId,groupName:a.addGroupName,addUser:$("#CurrentUser").val()}).success(function(b){a.initGroups()})},a.ChangeGroups=function(c){a.selectType=null==c.Id?"All Vendors":c.GroupName,null==c.Id&&(c.Id=0),b.post("/CallBackServices.asmx/GetContactByGroup",{gId:c.Id}).success(function(b){a.InitDataFunc(b)})},a.InitData=function(b){a.allContacts=b.slice();var c=b;return a.showingContacts=c,c},a.initGroups=function(){b.post("/CallBackServices.asmx/GetAllGroups",{}).success(function(b,c,d,e){a.Groups=b.d}).error(function(a,b,c,d){alert("error get GetAllGroups: "+b+" error :"+a.d)})},a.initGroups(),a.InitDataFunc=function(b){var c=a.InitData(b.d),d=c;d.length>0&&(a.currentContact=c[0],m_current_contact=a.currentContact)},b.post("/CallBackServices.asmx/GetContact",{p:"1"}).success(function(b,c,d,e){a.InitDataFunc(b),a.AllTest=b.d}).error(function(b,c,d,e){a.LogError=b,alert("error get contacts: "+c+" error :"+b.d)}),a.initLenderList=function(){b.post("/CallBackServices.asmx/GetLenderList",{}).success(function(b,c){a.lenderList=_.uniq(b.d)})},a.initLenderList(),a.predicate="Name",a.group_text_order="group_text",a.addContact={},a.selectType="All Vendors",a.query={},a.addContactFunc=function(){var c=a.query.Type;if(!a.addContact||!a.addContact.Name)return void alert("Please fill vender Name !");null!=c&&(a.addContact.Type=c);a.addContact;b.post("/CallBackServices.asmx/AddContact",{contact:a.addContact}).success(function(b,c,d,e){a.allContacts.push(b.d),a.InitData(a.allContacts);var f=b.d;a.currentContact=f,m_current_contact=a.currentContact,a.initLenderList();var g=$(".popup_employee_list_item_active:first").position().top;$("#employee_list").scrollTop(g),alert("Add"+a.currentContact.Name+" succeed !")}).error(function(a,b,c,d){var e=a&&a.Message?a.Message:JSON.stringify(a);alert("Add contact error: "+e)})},a.filterContactFunc=function(b,c){var d=angular.element(b.currentTarget).html();if("string"==typeof c)return a.query={},a.selectType=d,!0;a.query.Type=c;var e=4==c&&"Lenders"!=d?d:"";return a.query.CorpName=e,a.addContact.CorpName=e,a.selectType=d,!0},a.SaveCurrent=function(){b.post("/CallBackServices.asmx/SaveContact",{json:a.currentContact}).success(function(b,c,d,e){alert("Save succeed!"),a.initLenderList()}).error(function(a,b,c,d){alert("geting SaveCurrent error"+b+"error:"+JSON.stringify(a.d))})},a.FilterContact=function(b){if(a.showingContacts=a.allContacts,!(0>b))for(var c=a.allContacts,d=0;d<c.length;d++)c.Type!=b&&a.showingContacts.splice(d,1)},a.selectCurrent=function(b){a.currentContact=b,m_current_contact=b}}]);